var BalloonInfo=pc.createScript("balloonInfo");BalloonInfo.attributes.add("BalloonObject",{type:"entity"}),BalloonInfo.attributes.add("stringSegments",{type:"number",default:5,precision:1}),BalloonInfo.attributes.add("itemSKU",{type:"string"}),BalloonInfo.attributes.add("itemNumber",{type:"string"}),BalloonInfo.attributes.add("Joints",{type:"entity",array:!0}),BalloonInfo.attributes.add("floatStrength",{type:"number",precision:2,default:.9}),Object.defineProperty(BalloonInfo.prototype,"stringLength",{get:function(){return this.m_stringLength},set:function(t){for(var i=t/(this.entity.children.length-1),n=0;n<this.entity.children.length;n++)if(void 0!==this.entity.children[n].script){var e=this.entity.children[n].script.pointToPointConstraint;e.enabled=!1,e.pivotB=new pc.Vec3(0,i/2,0),n<this.entity.children.length-1?(e.pivotA=new pc.Vec3(0,-i/2,0),this.entity.children[n].collision.height=.9*i):e.pivotB=new pc.Vec3(0,i/2,0),e.enabled=!0}this.m_stringLength=t}}),BalloonInfo.prototype.initialize=function(){this.scalingTime=0,this.m_stringLength=1,this.destroyTimer=0,this.startDestroy=!1,this.setStart=!1,void 0!==this.entity.script.prepareBalloon&&(this.m_stringLength=this.entity.script.prepareBalloon.StringLength)},BalloonInfo.prototype.destroyBalloon=function(){this.BalloonObject.enabled=!1,this.destroyTimer=0,this.startDestroy=!0;var t=new pc.Vec3(pc.math.random(-1,1),0,pc.math.random(-1,1));this.Joints[this.Joints.length-2].rigidbody.applyForce(t.scale(2)),this.Joints.pop()},BalloonInfo.prototype.update=function(t){if(null!==this.BalloonObject&&!this.startDestroy){if("dynamic"==this.BalloonObject.rigidbody.type&&this.BalloonObject.rigidbody.applyForce(0,this.floatStrength,0),this.scalingTime<.5){if(this.scalingTime+=t,this.scalingTime>=.5&&(this.scalingTime=.5,void 0===this.entity.script.prepareBalloon)){this.BalloonObject.collision.enabled=!1,this.BalloonObject.children[0].collision.enabled=!0,this.BalloonObject.children[0].collision.enabled=!1,this.BalloonObject.collision.enabled=!0;for(var i=0;i<this.entity.children.length;i++)this.entity.children[i].rigidbody.type="dynamic";for(i=0;i<this.entity.children.length;i++)this.entity.children[i].script.pointToPointConstraint.enabled=!0}var n=this.scalingTime/.5,e=pc.math.lerp(0,1,n);this.BalloonObject.setLocalScale(new pc.Vec3(e,e,e))}if(!this.setStart&&void 0!==this.entity.script.prepareBalloon){for(i=0;i<this.entity.children.length;i++)this.entity.children[i].rigidbody.type="dynamic";for(i=0;i<this.entity.children.length;i++)this.entity.children[i].script.pointToPointConstraint.enabled=!0;this.setStart=!0}}var o=[];if(this.Joints.length>1)for(i=0;i<this.Joints.length;i++)if(0===i)o.push(this.entity.getPosition());else{var s=new pc.Vec3;this.Joints[i].getWorldTransform().transformPoint(this.Joints[i].script.pointToPointConstraint.pivotA,s),o.push(s)}this.entity.script.lineRenderer.Points=o,this.startDestroy&&(this.destroyTimer+=t,this.destroyTimer>=.5&&this.entity.destroy())};var CameraOrbit=pc.createScript("cameraOrbit");CameraOrbit.attributes.add("sensitivity",{type:"number",precision:2,default:2}),CameraOrbit.attributes.add("minAngle",{type:"number",precision:2,default:-30}),CameraOrbit.attributes.add("maxAngle",{type:"number",precision:2,default:75});var isSpinning,overspin,camDist=0,inputStart=new pc.Vec2,input=new pc.Vec2,startRotation=new pc.Vec3,curRotation=new pc.Vec3,inertiaRotation=new pc.Vec3,endRotation=new pc.Vec3,orbitStartStartDistance=20,startMeasure=!1,cameraSet=!1;CameraOrbit.prototype.initialize=function(){var onMouseOut=function(t){isSpinning=!1,overspin=!1,startMeasure=!1};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)})),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)}))),this.on("enable",(function(){startMeasure=!1,isSpinning=!1,overspin=!1,inertiaRotation=new pc.Vec3(0,0,0)})),this.app.mouse.disableContextMenu()};var touchCount=0;CameraOrbit.prototype.onTouchStartEndCancel=function(t){this.enabled&&(1==(touchCount=t.touches.length)&&(inputStart.x=t.touches[0].x,inputStart.y=t.touches[0].y,startMeasure=!0,overspin=!1,isSpinning=!1),1!=touchCount&&this.endOrbit())},CameraOrbit.prototype.onTouchMove=function(t){if(this.enabled&&"MainCamera"==this.entity.name&&1==(touchCount=t.touches.length)){if(startMeasure)input.x=t.touches[0].x,input.y=t.touches[0].y,inputStart.distance(input)>orbitStartStartDistance&&(inputStart=input.clone(),this.startOrbit(),startMeasure=!1,isSpinning=!0);isSpinning&&(input.x=t.touches[0].x,input.y=t.touches[0].y,this.moveOrbit(input.x,input.y))}},CameraOrbit.prototype.onMouseDown=function(t){this.enabled&&"MainCamera"==this.entity.name&&(t.button==pc.MOUSEBUTTON_LEFT&&(inputStart.x=t.x,inputStart.y=t.y,startMeasure=!0,overspin=!1,isSpinning=!1),(t.button==pc.MOUSEBUTTON_RIGHT||touchCount>0)&&(startMeasure=!1,isSpinning=!1,overspin=!1,inertiaRotation=new pc.Vec3.ZERO))},CameraOrbit.prototype.onMouseMove=function(t){if(this.enabled&&"MainCamera"==this.entity.name){if(startMeasure)input.x=t.x,input.y=t.y,inputStart.distance(input)>orbitStartStartDistance&&(inputStart=input.clone(),this.startOrbit(),startMeasure=!1,isSpinning=!0);isSpinning&&(input.x=t.x,input.y=t.y,this.moveOrbit(input.x,input.y))}},CameraOrbit.prototype.onMouseUp=function(t){this.enabled&&"MainCamera"==this.entity.name&&t.button==pc.MOUSEBUTTON_LEFT&&(input.x=t.x,input.y=t.y,this.endOrbit())},CameraOrbit.prototype.startOrbit=function(){overspin=!1,camDist=this.entity.parent.getPosition().distance(this.entity.getPosition()),cameraSet?startRotation=curRotation.clone():(startRotation=this.entity.getEulerAngles(),curRotation=startRotation.clone(),cameraSet=!0)},CameraOrbit.prototype.moveOrbit=function(t,i){var n=-.1*this.sensitivity*(inputStart.x-t),o=.06*this.sensitivity*(inputStart.y-i);endRotation.x=startRotation.x+o,endRotation.y=startRotation.y+n;var e=90-this.minAngle+90,a=90-this.maxAngle+90;endRotation.x=pc.math.clamp(endRotation.x,a,e),curRotation.x=pc.math.clamp(curRotation.x,a,e),inertiaRotation.x=.5*inertiaRotation.x+.5*(endRotation.x-curRotation.x),inertiaRotation.y=.5*inertiaRotation.y+.5*(endRotation.y-curRotation.y),curRotation.x+=inertiaRotation.x,curRotation.y+=inertiaRotation.y;var s=new pc.Quat;s.setFromEulerAngles(curRotation.x,curRotation.y,curRotation.z);var r=s.transformVector(new pc.Vec3(0,0,camDist));r=r.add(this.entity.parent.getPosition()),this.entity.setRotation(s),this.entity.setPosition(r)},CameraOrbit.prototype.endOrbit=function(){var t=Math.floor(curRotation.y/360);curRotation.y-=360*t,overspin=!!isSpinning,isSpinning=!1,startMeasure=!1},CameraOrbit.prototype.update=function(t){if(overspin)if(Math.abs(inertiaRotation.y)>1||Math.abs(inertiaRotation.x)>1){inertiaRotation.x*=.95,inertiaRotation.y*=.95,curRotation.x+=inertiaRotation.x,curRotation.y+=inertiaRotation.y;var i=90-this.minAngle+90,n=90-this.maxAngle+90;curRotation.x=pc.math.clamp(curRotation.x,n,i);var o=new pc.Quat;o.setFromEulerAngles(curRotation.x,curRotation.y,curRotation.z);var e=o.transformVector(new pc.Vec3(0,0,camDist));e=e.add(this.entity.parent.getPosition()),this.entity.setRotation(o),this.entity.setPosition(e)}else overspin=!1};var BlockMouseInput=pc.createScript("blockMouseInput");BlockMouseInput.prototype.initialize=function(){console.log("darry"),this.entity.element.on("mousedown",(function(t){"playcanvas-delete"===event.element.id&&t.stopPropagation()}),this)},BlockMouseInput.prototype.update=function(t){};var BalloonManager=pc.createScript("balloonManager");BalloonManager.attributes.add("baseUrl",{type:"string"}),BalloonManager.attributes.add("gltfFilename",{type:"string",array:!0}),BalloonManager.attributes.add("balloonEntity",{type:"entity"}),BalloonManager.attributes.add("balloonHolderEntity",{type:"entity"}),BalloonManager.attributes.add("stringEntity",{type:"entity"}),BalloonManager.attributes.add("index",{type:"number",default:0}),BalloonManager.prototype.initialize=function(){this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onRelease,this),this.myIndex=0,this.exposeFunctions(),console.log("this",this)},BalloonManager.prototype.update=function(t){},BalloonManager.prototype.onEnter=function(t){this.hovered=!0},BalloonManager.prototype.onPress=function(t){this.balloonHolderEntity.script.lineRenderer.renderLine=!0,this.CloningBalloon()},BalloonManager.prototype.onRelease=function(t){},BalloonManager.prototype.CloningBalloon=function(t){var e=this.stringEntity.clone();pc.app.root.addChild(e),e.enabled=!0;var n=e.children[5].children[0];n.script.LoadGltfExternal.myIndex=this.myIndex,n.script.LoadGltfExternal.spawnBalloonFromSKU(t),console.log(n.name),this.myIndex+=1,this.myIndex>n.script.LoadGltfExternal.gltfFilename.length-1&&(this.myIndex=0)},BalloonManager.prototype.exposeFunctions=function(){var t=this.entity.script.balloonManager;window.CloningBalloon=function(e){t.CloningBalloon(e)}};var CameraZoom=pc.createScript("cameraZoom");CameraZoom.attributes.add("touchSensitivity",{type:"number",precision:2,default:.3}),CameraZoom.attributes.add("mouseWheelSensitivity",{type:"number",precision:2,default:20}),CameraZoom.attributes.add("minZoom",{type:"number",precision:2,default:30}),CameraZoom.attributes.add("maxZoom",{type:"number",precision:2,default:70});var curValue=0,curve=new pc.Curve,startDistance=0,startFOV=0;CameraZoom.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)})),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)}))),curve.add(0,this.minZoom),curve.add(1,this.maxZoom),curValue=(this.entity.camera.fov-this.minZoom)/(this.maxZoom-this.minZoom),this.entity.camera.fov=curve.value(curValue),startFOV=this.entity.camera.fov},CameraZoom.prototype.onMouseWheel=function(t){var o=t.wheel/2;o=.01*-o*this.mouseWheelSensitivity,curValue+=o,this.entity.camera.fov=curve.value(curValue),t.event.preventDefault()},CameraZoom.prototype.onTouchStartEndCancel=function(t){var o=t.touches;if(2==o.length){var e=new pc.Vec2,a=new pc.Vec2;e.x=o[0].x,e.y=o[0].y,a.x=o[1].x,a.y=o[1].y,startDistance=e.distance(a),startFOV=this.entity.camera.fov}},CameraZoom.prototype.onTouchMove=function(t){var o=t.touches;if(2==o.length){var e=new pc.Vec2,a=new pc.Vec2;e.x=o[0].x,e.y=o[0].y,a.x=o[1].x,a.y=o[1].y;var i=e.distance(a),c=(startDistance-i)*this.touchSensitivity;c+=startFOV,c=pc.math.clamp(c,this.minZoom,this.maxZoom),this.entity.camera.fov=c}};var BalloonSelection=pc.createScript("balloonSelection");BalloonSelection.attributes.add("MainCamera",{type:"entity"}),Object.defineProperty(BalloonSelection.prototype,"selectedItem",{get:function(){return this.m_currentItem},set:function(t){this.m_currentItem=t}}),BalloonSelection.prototype.initialize=function(){this.m_currentItem=void 0,this.startPosition=new pc.Vec2(0,0),this.clickTime=0,this.startMeasure=!1,this.startDrag=!1,this.dragDistance=0,this.dragOffset=new pc.Vec3(0,0,0),this.moveInput=new pc.Vec2(0,0),this.setupHighlight(),window.addEventListener("resize",this.onResize.bind(this)),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)})),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)}))),this.onResize()},BalloonSelection.prototype.setupHighlight=function(){this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget=new pc.RenderTarget({colorBuffer:this.texture,depth:!0,samples:8}),this.highlightLayer=this.app.scene.layers.getLayerByName("HighlightLayer"),this.highlightLayer.renderTarget=this.renderTarget,this.highlightCamera=new pc.Entity,this.highlightCamera.addComponent("camera",{clearColor:new pc.Color(0,0,0,0),layers:[this.highlightLayer.id],fov:this.MainCamera.camera.fov}),this.app.root.addChild(this.highlightCamera),this.highlight=new pc.SaturationEffect(this.app.graphicsDevice),this.highlight.saturation=0,this.highlight.texture=this.texture,this.MainCamera.camera.postEffects.addEffect(this.highlight)},BalloonSelection.prototype.onResize=function(){this.MainCamera.camera.postEffects.removeEffect(this.highlight),this.app.scene.layers.remove(this.highlightLayer),this.texture.destroy(),this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget.destroy(),this.renderTarget=new pc.RenderTarget(this.app.graphicsDevice,this.texture,{depth:!0}),this.highlightLayer.renderTarget=this.renderTarget,this.app.scene.layers.insert(this.highlightLayer,0),this.highlight.texture=this.texture,this.MainCamera.camera.postEffects.addEffect(this.highlight)},BalloonSelection.prototype.onTouchStart=function(t){if(1==t.touches.length){var e=new pc.Vec2;e.x=t.touches[0].x,e.y=t.touches[0].y,this.moveInput=e,this.startPosition=e,this.clickTime=0,this.startMeasure=!0,this.startDrag?this.dragEnd(e):this.dragStart(e)}0===t.touches.length&&this.startDrag&&this.dragEnd()},BalloonSelection.prototype.onTouchEndCancel=function(t){if(1==t.touches.length){var e=new pc.Vec2;e.x=t.touches[0].x,e.y=t.touches[0].y,this.moveInput=e,this.startMeasure&&(this.clickTime<.3&&this.startPosition.distance(e)<10&&this.clickSelection(e),this.startMeasure=!1,this.clickTime=0),this.startDrag&&this.dragEnd(e)}0===t.touches.length&&this.startDrag&&this.dragEnd()},BalloonSelection.prototype.onTouchMove=function(t){if(this.startDrag){var e=new pc.Vec2;e.x=t.touches[0].x,e.y=t.touches[0].y,this.moveInput=e}},BalloonSelection.prototype.onMouseDown=function(t){if(t.button==pc.MOUSEBUTTON_LEFT){var e=new pc.Vec2;e.x=t.x,e.y=t.y,this.startPosition=e,this.clickTime=0,this.startMeasure=!0,this.moveInput=e,this.dragStart(e)}},BalloonSelection.prototype.onMouseUp=function(t){if(t.button==pc.MOUSEBUTTON_LEFT){var e=new pc.Vec2;e.x=t.x,e.y=t.y,this.startDrag&&(this.moveInput=e,this.dragEnd(e)),this.startMeasure&&(this.clickTime<.3&&this.startPosition.distance(e)<10&&this.clickSelection(e),this.startMeasure=!1,this.clickTime=0)}},BalloonSelection.prototype.onMouseMove=function(t){if(this.startDrag){var e=new pc.Vec2;e.x=t.x,e.y=t.y,this.moveInput=e}},BalloonSelection.prototype.dragStart=function(t){if(void 0!==this.m_currentItem){var e=this.MainCamera.camera.screenToWorld(t.x,t.y,this.MainCamera.camera.farClip),i=this.app.systems.rigidbody.raycastFirst(this.MainCamera.getPosition(),e);i&&i.entity.children[0]==this.m_currentItem&&(this.dragDistance=this.MainCamera.getPosition().distance(i.point),this.dragOffset=i.point.sub(i.entity.getPosition()),this.MainCamera.script.cameraOrbit.enabled=!1,this.MainCamera.script.cameraZoom.enabled=!1,i.entity.script.pointToPointConstraint.enabled=!1,i.entity.rigidbody.type=pc.BODYTYPE_KINEMATIC,i.entity.script.pointToPointConstraint.enabled=!0,this.startDrag=!0)}},BalloonSelection.prototype.dragEnd=function(){this.MainCamera.script.cameraOrbit.enabled=!0,this.MainCamera.script.cameraZoom.enabled=!0,void 0!==this.m_currentItem&&(this.m_currentItem.parent.script.pointToPointConstraint.enabled=!1,this.m_currentItem.parent.rigidbody.type=pc.BODYTYPE_DYNAMIC,this.m_currentItem.parent.script.pointToPointConstraint.enabled=!0),this.startDrag=!1},BalloonSelection.prototype.clickSelection=function(t){for(var e=0;e<this.entity.script.balloonTracker.BalloonParent.children.length;e++){(h=this.entity.script.balloonTracker.BalloonParent.children[e]).script.balloonInfo.BalloonObject.collision.enabled=!1,h.script.balloonInfo.BalloonObject.children[0].collision.enabled=!0}var i=this.MainCamera.camera.screenToWorld(t.x,t.y,this.MainCamera.camera.farClip),s=this.app.systems.rigidbody.raycastFirst(this.MainCamera.getPosition(),i);if(s){var a=s.entity;if(void 0!==this.m_currentItem&&this.m_currentItem!=a){var o=this.m_currentItem.model.layers.slice();o.pop(),this.m_currentItem.model.layers=o,this.m_currentItem=void 0,this.highlight.saturation=0}if(this.m_currentItem!==a&&!a.name.toString().includes("Joint")){var n=a.model.layers.slice();n.push(this.highlightLayer.id),a.model.layers=n,this.m_currentItem=a,this.highlight.saturation=-1}}else if(void 0!==this.m_currentItem){var r=this.m_currentItem.model.layers.slice();r.pop(),this.m_currentItem.model.layers=r,this.m_currentItem=void 0,this.highlight.saturation=0}for(e=0;e<this.entity.script.balloonTracker.BalloonParent.children.length;e++){var h;(h=this.entity.script.balloonTracker.BalloonParent.children[e]).script.balloonInfo.BalloonObject.children[0].collision.enabled=!1,h.script.balloonInfo.BalloonObject.collision.enabled=!0,console.log("Deselect: "+h.name+" Collision Type: "+h.script.balloonInfo.BalloonObject.children[0].collision.type+" Mesh: "+h.script.balloonInfo.BalloonObject.children[0].collision.model.graph.name)}},BalloonSelection.prototype.update=function(t){if(this.highlightCamera&&(this.highlightCamera.camera.fov=this.MainCamera.camera.fov,this.highlightCamera.setPosition(this.MainCamera.getPosition()),this.highlightCamera.setRotation(this.MainCamera.getRotation())),this.startMeasure&&(this.clickTime+=t),this.startDrag&&void 0!==this.m_currentItem){var e=this.MainCamera.camera.screenToWorld(this.moveInput.x,this.moveInput.y,this.MainCamera.camera.farClip),i=new pc.Vec3;i=(i=(i=(i=e.clone()).sub(this.MainCamera.getPosition())).normalize()).scale(this.dragDistance);var s=new pc.Vec3;s=i.add(this.MainCamera.getPosition().clone()).sub(this.dragOffset);var a=this.m_currentItem.parent.parent.getPosition(),o=new pc.Vec3;o=(o=s.sub(a)).normalize();var n=a.clone();n=n.distance(s);var r=this.m_currentItem.parent.parent.script.balloonInfo.stringLength+Math.abs(this.m_currentItem.parent.script.pointToPointConstraint.pivotA.y);if(n>r){var h=new pc.Vec3;(h=o.scale(r)).y<.9*r&&(h.y=.9*r);var c=new pc.Vec3;c=c.lerp(this.m_currentItem.parent.getPosition(),h,8*t),this.this.m_currentItem.parent.setPosition(c)}else{s.y<.9*r&&(s.y=.9*r);var l=new pc.Vec3;l=l.lerp(this.m_currentItem.parent.getPosition(),s,8*t),this.m_currentItem.parent.setPosition(l)}}};var PointToPointConstraint=pc.createScript("pointToPointConstraint");PointToPointConstraint.attributes.add("pivotA",{title:"Pivot",description:"Position of the constraint in the local space of this entity.",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("entityB",{title:"Connected Entity",description:"Optional second entity",type:"entity"}),PointToPointConstraint.attributes.add("pivotB",{title:"Connected Pivot",description:"Position of the constraint in the local space of entity B (if specified).",type:"vec3",default:[0,0,0]}),PointToPointConstraint.attributes.add("breakingThreshold",{title:"Break Threshold",description:"Maximum breaking impulse threshold required to break the constraint.",type:"number",default:34e37}),PointToPointConstraint.attributes.add("enableCollision",{title:"Enable Collision",description:"Enable collision between linked rigid bodies.",type:"boolean",default:!0}),PointToPointConstraint.attributes.add("debugRender",{title:"Debug Render",description:"Enable to render a representation of the constraint.",type:"boolean",default:!1}),PointToPointConstraint.attributes.add("debugColor",{title:"Debug Color",description:"The color of the debug rendering of the constraint.",type:"rgb",default:[1,0,0]}),PointToPointConstraint.prototype.initialize=function(){this.createConstraint(),this.on("attr",(function(t,i,n){"pivotA"===t||"entityB"===t||"pivotB"===t?this.createConstraint():"breakingThreshold"===t&&(this.constraint.setBreakingImpulseThreshold(this.breakingThreshold),this.activate())})),this.on("enable",(function(){this.createConstraint()})),this.on("disable",(function(){this.destroyConstraint()})),this.on("destroy",(function(){this.destroyConstraint()}))},PointToPointConstraint.prototype.createConstraint=function(){this.constraint&&this.destroyConstraint();var t=this.entity.rigidbody.body,i=new Ammo.btVector3(this.pivotA.x,this.pivotA.y,this.pivotA.z);if(this.entityB&&this.entityB.rigidbody){var n=this.entityB.rigidbody.body,o=new Ammo.btVector3(this.pivotB.x,this.pivotB.y,this.pivotB.z);this.constraint=new Ammo.btPoint2PointConstraint(t,n,i,o)}else this.constraint=new Ammo.btPoint2PointConstraint(t,i);this.app.systems.rigidbody.dynamicsWorld.addConstraint(this.constraint,!this.enableCollision),this.activate()},PointToPointConstraint.prototype.destroyConstraint=function(){this.constraint&&(this.app.systems.rigidbody.dynamicsWorld.removeConstraint(this.constraint),Ammo.destroy(this.constraint),this.constraint=null)},PointToPointConstraint.prototype.activate=function(){this.entity.rigidbody.activate(),this.entityB&&this.entityB.rigidbody.activate()},PointToPointConstraint.prototype.update=function(t){if(this.debugRender){var i=new pc.Vec3;this.entity.getWorldTransform().transformPoint(this.pivotA,i),this.app.renderLine(this.entity.getPosition(),i,this.debugColor),this.entityB&&this.app.renderLine(this.entityB.getPosition(),i,this.debugColor)}};var LoadGltfExternal=pc.createScript("LoadGltfExternal");LoadGltfExternal.attributes.add("baseUrl",{type:"string"}),LoadGltfExternal.attributes.add("gltfFilename",{type:"string",array:!0}),LoadGltfExternal.attributes.add("index",{type:"number",default:0}),LoadGltfExternal.prototype.initialize=function(){this.myIndex=0,console.log(this.myIndex)},LoadGltfExternal.prototype.update=function(t){this.app.keyboard.wasPressed(pc.KEY_SPACE)&&this.spawnBalloon()},LoadGltfExternal.prototype.spawnFirstBalloon=function(){var t=this.app,e=this,a=e.gltfFilename[this.myIndex];t.assets.loadFromUrl(e.baseUrl+a,"json",(function(a,o){var l=JSON.parse(o.resource);loadGltf(l,t.graphicsDevice,(function(a,o){var l=new pc.Asset("gltf","model",{url:""});l.resource=o.model,l.loaded=!0,t.assets.add(l),e.entity.addComponent("model",{asset:l})}),{basePath:e.baseUrl})}))},LoadGltfExternal.prototype.clearBalloon=function(){this.app;this.entity.model&&this.entity.removeComponent("model")},LoadGltfExternal.prototype.spawnBalloonFromSKU=function(t){var e=this.app,a=this;a.entity.model&&a.entity.removeComponent("model");var o="";t?o=t:(o=a.gltfFilename[this.myIndex],console.log("The Index is "+this.myIndex)),console.log("My Balloon = "+o),e.assets.loadFromUrl(a.baseUrl+o+".gltf","json",(function(t,o){var l=JSON.parse(o.resource);loadGltf(l,e.graphicsDevice,(function(t,o){var l=new pc.Asset("gltf","model",{url:""});l.resource=o.model,l.loaded=!0,e.assets.add(l),a.entity.addComponent("model",{asset:l})}),{basePath:a.baseUrl})}))};var LineRenderer=pc.createScript("lineRenderer");LineRenderer.attributes.add("Thickness",{type:"number",default:.003}),LineRenderer.attributes.add("Points",{type:"vec3",array:!0}),LineRenderer.attributes.add("LineColor",{type:"rgb",default:[.5,.5,.5]}),LineRenderer.attributes.add("smoothLine",{type:"boolean",default:!0}),LineRenderer.attributes.add("segmentLength",{type:"number",default:.05});var MAX_VERTICES=600,VERTEX_SIZE=3;LineRenderer.prototype.initialize=function(){this.MAX_VERTICES=2*this.Points.length;var e={attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec3 aPosition;","","uniform mat4 matrix_viewProjection;","","void main(void)","{","    gl_Position = matrix_viewProjection * vec4(aPosition, 1.0);","}"].join("\n"),fshader:["precision mediump float;","","uniform vec3 lineColor;","","void main(void)","{","    gl_FragColor = vec4(lineColor,1);","}"].join("\n")},t=new pc.Shader(this.app.graphicsDevice,e);this.material=new pc.Material,this.material.shader=t,this.material.setParameter("lineColor",new Float32Array([this.LineColor.r,this.LineColor.g,this.LineColor.b])),this.material.cull=pc.CULLFACE_NONE,this.vertices=[],this.vertexData=new Float32Array(MAX_VERTICES*VERTEX_SIZE),this.vertexIndexArray=[];for(var i=0;i<this.vertexData.length;++i)this.vertexIndexArray.push(i);this.mesh=new pc.Mesh(this.app.graphicsDevice),this.mesh.clear(!0,!1),this.mesh.setPositions(this.vertexData,VERTEX_SIZE,MAX_VERTICES*VERTEX_SIZE),this.mesh.setIndices(this.vertexIndexArray),this.mesh.update(pc.PRIMITIVE_TRISTRIP);var r=new pc.GraphNode,a=new pc.MeshInstance(r,this.mesh,this.material),n=new pc.Model;n.graph=r,n.meshInstances=[a],this.entity.addComponent("model",{type:"asset"}),this.entity.model.model=n,this.entity.model.layers=[this.app.scene.layers.getLayerByName("World").id]},LineRenderer.prototype.buildLine=function(){var e=[];e=this.Points.slice(),this.smoothLine&&(e=this.smoothPoints(this.Points.slice()),MAX_VERTICES=2*e.length);for(var t=0;t<e.length;t++){var i=e[t],r=i.clone();t<e.length-1?r=e[t+1]:i=e[t-1];var a=new pc.Vec3;a=a.sub2(r,i);var n=(new pc.Quat).setFromEulerAngles(0,0,90).transformVector(a).normalize().scale(this.Thickness);n=this.app.root.findByName("MainCamera").getRotation().transformVector(n);i=e[t],this.vertices.unshift({vertexPair:[i.x+-1*n.x,i.y+-1*n.y,i.z+-1*n.z,i.x+1*n.x,i.y+1*n.y,i.z+1*n.z]})}},LineRenderer.prototype.prepareVertexData=function(){this.vertexData=new Float32Array(MAX_VERTICES*VERTEX_SIZE),this.vertexIndexArray=[];for(var e=0;e<this.vertexData.length;++e)this.vertexIndexArray.push(e);for(e=0;e<this.vertices.length;e++){var t=this.vertices[e];this.vertexData[6*e+0]=t.vertexPair[0],this.vertexData[6*e+1]=t.vertexPair[1],this.vertexData[6*e+2]=t.vertexPair[2],this.vertexData[6*e+3]=t.vertexPair[3],this.vertexData[6*e+4]=t.vertexPair[4],this.vertexData[6*e+5]=t.vertexPair[5]}},LineRenderer.prototype.updateLine=function(){this.vertices=[],this.buildLine(),this.vertices.length>1?(this.prepareVertexData(),this.mesh.setPositions(this.vertexData,VERTEX_SIZE,2*this.vertices.length),this.mesh.setIndices(this.vertexIndexArray,2*this.vertices.length),this.mesh.update(pc.PRIMITIVE_TRISTRIP),this.entity.model.enabled=!0):this.entity.model.enabled=!1},LineRenderer.prototype.update=function(e){this.Points.length>1&&this.updateLine()},LineRenderer.prototype.smoothPoints=function(t){for(var i=new pc.Curve,r=new pc.Curve,a=new pc.Curve,n=1/t.length,s=0;s<t.length;s++)i.add(s*n,t[s].x),r.add(s*n,t[s].y),a.add(s*n,t[s].z);i.type=pc.CURVE_SPLINE,r.type=pc.CURVE_SPLINE,a.type=pc.CURVE_SPLINE,i.tension=.5,r.tension=.5,a.tension=.5;var o=[];for(e=0;e<t.length;e++)if(o.push(t[e]),e+1<t.length){var h=t[e].clone();h=h.distance(t[e+1]);for(var d=Math.round(h/this.segmentLength),l=n/d,p=1;p<d;p++){var v=e*n+l*p,c=new pc.Vec3(i.value(v),r.value(v),a.value(v));o.push(c)}}return o};Object.assign(window,function(){var e={NUM:0,VEC:1,QUAT:2},AnimationKeyable=function(e,t,i){this.init(e,t,i)};AnimationKeyable.prototype.init=function(t,i,n){if(this.type=t||e.NUM,this.time=i||0,n)this.value=n;else switch(t){case e.NUM:this.value=0;break;case e.VEC:this.value=new pc.Vec3;break;case e.QUAT:this.value=new pc.Quat}return this},AnimationKeyable.prototype.copy=function(e){if(!e)return this;var t=AnimationKeyable._cloneValue(e.value);return this.init(e.type,e.time,t),(e.inTangent||0===e.inTangent)&&(this.inTangent=AnimationKeyable._cloneValue(e.inTangent)),(e.outTangent||0===e.outTangent)&&(this.outTangent=AnimationKeyable._cloneValue(e.outTangent)),this},AnimationKeyable.prototype.clone=function(){var e=AnimationKeyable._cloneValue(this.value),t=new AnimationKeyable(this.type,this.time,e);return(this.inTangent||0===this.inTangent)&&(t.inTangent=AnimationKeyable._cloneValue(this.inTangent)),(this.outTangent||0===this.outTangent)&&(t.outTangent=AnimationKeyable._cloneValue(this.outTangent)),t},AnimationKeyable._cloneValue=function(e){return e instanceof pc.Vec3||e instanceof pc.Quat||void 0!==e&&"function"==typeof e.clone?e.clone():e},AnimationKeyable.sum=function(t,i){if(!t||!i||t.type!=i.type)return null;var n=new AnimationKeyable(t.type);switch(t.type){case e.NUM:n.value=t.value+i.value;break;case e.VEC:n.value.add2(t.value,i.value);break;case e.QUAT:n.value.x=t.value.x+i.value.x,n.value.y=t.value.y+i.value.y,n.value.z=t.value.z+i.value.z,n.value.w=t.value.w+i.value.w}return n},AnimationKeyable.minus=function(t,i){if(!t||!i||t.type!=i.type)return null;var n=new AnimationKeyable(t.type);switch(t.type){case e.NUM:n.value=t.value-i.value;break;case e.VEC:n.value.sub2(t.value,i.value);break;case e.QUAT:n.value.x=t.value.x-i.value.x,n.value.y=t.value.y-i.value.y,n.value.z=t.value.z-i.value.z,n.value.w=t.value.w-i.value.w}return n},AnimationKeyable.mul=function(t,i){if(!t)return null;var n=new AnimationKeyable;switch(n.copy(t),t.type){case e.NUM:n.value*=i;break;case e.VEC:n.value.scale(i);break;case e.QUAT:n.value.x*=i,n.value.y*=i,n.value.z*=i,n.value.w*=i}return n},AnimationKeyable.div=function(e,t){return 0===t?null:AnimationKeyable.mul(e,1/t)},AnimationKeyable.linearBlend=function(t,i,n,s){if(!t||!i||t.type!==i.type)return null;var a;if(a=s||new AnimationKeyable(t.type),0===n)return a.copy(t),a;if(1===n)return a.copy(i),a;switch(t.type){case e.NUM:a.value=(1-n)*t.value+n*i.value;break;case e.VEC:a.value.lerp(t.value,i.value,n);break;case e.QUAT:a.value.slerp(t.value,i.value,n)}return a},AnimationKeyable.linearBlendValue=function(e,t,i){var n;return"number"==typeof e&&"number"==typeof t?(1-i)*e+i*t:e instanceof pc.Vec3&&t instanceof pc.Vec3||e instanceof pc.Vec2&&t instanceof pc.Vec2||e instanceof pc.Vec4&&t instanceof pc.Vec4?((n=e.clone()).lerp(e,t,i),n):e instanceof pc.Quat&&t instanceof pc.Quat?((n=e.clone()).slerp(e,t,i),n):null};var AnimationTarget=function(e,t,i){this.targetNode=e,this.targetPath=t,this.targetProp=i};AnimationTarget.prototype.toString=function(){var e="";return this.targetNode&&(e+=this.targetNode.name),this.targetPath&&(e+="_"+this.targetPath),this.targetProp&&(e+="_"+this.targetProp),e},AnimationTarget.prototype.copy=function(e){return e&&(this.targetNode=e.targetNode,this.targetPath=e.targetPath,this.targetProp=e.targetProp),this},AnimationTarget.prototype.clone=function(){return new AnimationTarget(this.targetNode,this.targetPath,this.targetProp)},AnimationTarget.prototype.blendToTarget=function(e,t){if(!(void 0===e||t>1||t<=0))if("localPosition"===this.targetPath&&this.vScale instanceof pc.Vec3&&(e instanceof pc.Vec3?(e.x*=this.vScale.x,e.y*=this.vScale.y,e.z*=this.vScale.z):"number"==typeof e&&"number"==typeof this.vScale[this.targetProp]&&(e*=this.vScale[this.targetProp])),1!==t){if(this.targetNode&&void 0!==this.targetNode[this.targetPath]){var i;if(this.targetProp&&this.targetProp in this.targetNode[this.targetPath]?(i=AnimationKeyable.linearBlendValue(this.targetNode[this.targetPath][this.targetProp],e,t),this.targetNode[this.targetPath][this.targetProp]=i):(i=AnimationKeyable.linearBlendValue(this.targetNode[this.targetPath],e,t),this.targetNode[this.targetPath]=i),"localEulerAngles"==this.targetPath){var n=new pc.Vec3;"x"===this.targetProp||"y"===this.targetProp||"z"===this.targetProp?n[this.targetProp]=i:n=i,this.targetNode.setLocalEulerAngles(n)}"function"==typeof this.targetNode._dirtifyLocal&&this.targetNode._dirtifyLocal()}}else this.updateToTarget(e)},AnimationTarget.prototype.updateToTarget=function(e){if(void 0!==e){if("localPosition"===this.targetPath&&this.vScale instanceof pc.Vec3&&(e instanceof pc.Vec3?(e.x*=this.vScale.x,e.y*=this.vScale.y,e.z*=this.vScale.z):"number"==typeof e&&"number"==typeof this.vScale[this.targetProp]&&(e*=this.vScale[this.targetProp])),this.targetNode&&void 0!==this.targetNode[this.targetPath]){if(this.targetProp&&this.targetProp in this.targetNode[this.targetPath]?this.targetNode[this.targetPath][this.targetProp]=e:this.targetNode[this.targetPath]=e,"localEulerAngles"==this.targetPath){var t=new pc.Vec3;"x"===this.targetProp||"y"===this.targetProp||"z"===this.targetProp?t[this.targetProp]=e:t=e,this.targetNode.setLocalEulerAngles(t)}"function"==typeof this.targetNode._dirtifyLocal&&this.targetNode._dirtifyLocal()}if(this.targetNode&&"weights"===this.targetPath&&this.targetNode.model)for(var i=this.targetNode.model.meshInstances,n=0;n<i.length;n++){var s=i[n].morphInstance;s&&s.setWeight(this.targetProp,e)}}},AnimationTarget.constructTargetNodes=function(e,t,i){if(e){var n=t||new pc.Vec3(1,1,1),s=new AnimationTarget(e);e.localScale&&(s.vScale=new pc.Vec3(e.localScale.x*n.x,e.localScale.y*n.y,e.localScale.z*n.z)),i[s.targetNode.name]=s;for(var a=0;a<e.children.length;a++)AnimationTarget.constructTargetNodes(e.children[a],s.vScale,i)}},AnimationTarget.getLocalScale=function(e,t){if(t.set(1,1,1),e)for(;e;)e.localScale&&t.mul(e.localScale),e=e.parent};var t={LINEAR:0,STEP:1,CUBIC:2,CUBICSPLINE_GLTF:3},AnimationCurve=function(){AnimationCurve.count++,this.name="curve"+AnimationCurve.count.toString(),this.type=t.LINEAR,this.keyableType=e.NUM,this.tension=.5,this.animTargets=[],this.duration=0,this.animKeys=[]};AnimationCurve.count=0,Object.defineProperty(AnimationCurve.prototype,"isPlaying",{get:function(){return!!this.session&&this.session.isPlaying},set:function(e){this.session&&(this.session.isPlaying=e)}}),Object.defineProperty(AnimationCurve.prototype,"loop",{get:function(){return!!this.session&&this.session.loop},set:function(e){this.session&&(this.session.loop=e)}}),Object.defineProperty(AnimationCurve.prototype,"bySpeed",{get:function(){return this.session?this.session.bySpeed:0},set:function(e){this.session&&(this.session.bySpeed=e)}}),AnimationCurve.prototype.copy=function(e){var t;for(this.name=e.name,this.type=e.type,this.keyableType=e.keyableType,this.tension=e.tension,this.duration=e.duration,this.animTargets=[],t=0;t<e.animTargets.length;t++)this.animTargets.push(e.animTargets[t].clone());for(this.animKeys=[],t=0;t<e.animKeys.length;t++){var i=new AnimationKeyable;i.copy(e.animKeys[t]),this.animKeys.push(i)}return this},AnimationCurve.prototype.clone=function(){return(new AnimationCurve).copy(this)},AnimationCurve.prototype.addTarget=function(e,t,i){var n=new AnimationTarget(e,t,i);this.animTargets.push(n)},AnimationCurve.prototype.setTarget=function(e,t,i){this.animTargets=[],this.addTarget(e,t,i)},AnimationCurve.prototype.clearTargets=function(){this.animTargets=[]},AnimationCurve.prototype.resetSession=function(){this.session&&(this.session.playable=this,this.session.animTargets=this.getAnimTargets(),this.session.isPlaying=!0,this.session.begTime=0,this.session.endTime=this.duration,this.session.curTime=0,this.session.bySpeed=1,this.session.loop=!0)},AnimationCurve.prototype.blendToTarget=function(e,t){this.session&&this.session.blendToTarget(e,t)},AnimationCurve.prototype.updateToTarget=function(e){this.session&&this.session.updateToTarget(e)},AnimationCurve.prototype.getAnimTargets=function(){var e={};return e[this.name]=this.animTargets,e},AnimationCurve.prototype.on=function(e,t,i,n,s){return this.session&&this.session.on(e,t,i,n,s),this},AnimationCurve.prototype.off=function(e,t,i){return this.session&&this.session.off(e,t,i),this},AnimationCurve.prototype.removeAllEvents=function(){return this.session&&this.session.removeAllEvents(),this},AnimationCurve.prototype.fadeIn=function(e){this.session||(this.session=new i(this)),this.session.fadeIn(e,this)},AnimationCurve.prototype.fadeOut=function(e){this.session&&this.session.fadeOut(e)},AnimationCurve.prototype.play=function(){this.session||(this.session=new i(this)),this.session.play(this)},AnimationCurve.prototype.resume=function(){this.session&&this.session.resume()},AnimationCurve.prototype.stop=function(){this.session&&this.session.stop()},AnimationCurve.prototype.pause=function(){this.session&&this.session.pause()},AnimationCurve.prototype.showAt=function(e,t,i,n,s){this.session&&this.session.showAt(e,t,i,n,s)},AnimationCurve.prototype.setAnimKeys=function(e){this.animKeys=e},AnimationCurve.prototype.insertKey=function(e,t,i){if(this.keyableType==e){for(var n=0;n<this.animKeys.length&&this.animKeys[n].time<t;)n++;if(n<this.animKeys.length&&this.animKeys[n].time==t)this.animKeys[n].value=i;else{var s=new AnimationKeyable(e,t,i);if(n>=this.animKeys.length)return this.animKeys.push(s),void(this.duration=t);this.animKeys.splice(n,0,s)}}},AnimationCurve.prototype.insertKeyable=function(e){if(e&&this.keyableType==e.type){for(var t=e.time,i=0;i<this.animKeys.length&&this.animKeys[i].time<t;)i++;if(!(i<this.animKeys.length&&this.animKeys[i].time==t))return i>=this.animKeys.length?(this.animKeys.push(e),void(this.duration=t)):void this.animKeys.splice(i,0,e);this.animKeys[i]=e}},AnimationCurve.prototype.removeKey=function(e){e<=this.animKeys.length&&(e==this.animKeys.length-1&&(this.duration=e-1>=0?this.animKeys[e-1].time:0),this.animKeys.splice(e,1))},AnimationCurve.prototype.removeAllKeys=function(){this.animKeys=[],this.duration=0},AnimationCurve.prototype.shiftKeyTime=function(e){for(var t=0;t<this.animKeys.length;t++)this.animKeys[t].time+=e},AnimationCurve.prototype.getSubCurve=function(e,t){var i,n=new AnimationCurve;for(n.type=this.type,n.name=this.name+"_sub",n.keyableType=this.keyableType,n.animTargets=this.animTargets,n.tension=this.tension,n.animTargets=[],i=0;i<this.animTargets.length;i++)n.animTargets.push(this.animTargets[i].clone());var s=-1;for(i=0;i<this.animKeys.length;i++)if(this.animKeys[i].time>=e&&this.animKeys[i].time<=t){s<0&&(s=this.animKeys[i].time);var a=(new AnimationKeyable).copy(this.animKeys[i]);a.time-=s,n.animKeys.push(a)}return n.duration=-1===s?0:t-s,n},AnimationCurve.prototype.evalLINEAR=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var t,i,n=new AnimationKeyable,s=0;s<this.animKeys.length;s++){if(this.animKeys[s].time===e)return n.copy(this.animKeys[s]),n;if(this.animKeys[s].time>e){i=this.animKeys[s];break}t=this.animKeys[s]}if(!t||!i)return n.copy(t||i),n.time=e,n;var a=(e-t.time)/(i.time-t.time);return(n=AnimationKeyable.linearBlend(t,i,a)).time=e,n},AnimationCurve.prototype.evalLINEAR_cache=function(e,t,i){if(!this.animKeys||0===this.animKeys.length)return null;var n,s,a=i,r=0;t&&(r=t);for(var o=r,h=0;h<this.animKeys.length;h++){if(o=(r+h)%this.animKeys.length,this.animKeys[o].time===e)return a.copy(this.animKeys[o]),a._cacheKeyIdx=o,a;if(0===o&&this.animKeys[o].time>e){n=null,s=this.animKeys[o];break}if(o==this.animKeys.length-1&&this.animKeys[o].time<e){n=this.animKeys[o],s=null;break}if(this.animKeys[o].time>e&&(o-1<0||this.animKeys[o-1].time<e)){n=this.animKeys[o-1],s=this.animKeys[o];break}}if(!n||!s)return a.copy(n||s),a.time=e,a._cacheKeyIdx=o,a;var l=(e-n.time)/(s.time-n.time);return(a=AnimationKeyable.linearBlend(n,s,l,a)).time=e,a._cacheKeyIdx=o,a},AnimationCurve.prototype.evalSTEP=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var t=this.animKeys[0],i=1;i<this.animKeys.length&&this.animKeys[i].time<=e;i++)t=this.animKeys[i];var n=new AnimationKeyable;return n.copy(t),n.time=e,n},AnimationCurve.prototype.evalSTEP_cache=function(e,t,i){if(!this.animKeys||0===this.animKeys.length)return null;var n=0;t&&(n=t);for(var s=n,a=this.animKeys[s],r=1;r<this.animKeys.length;r++){if(0===(s=(n+r)%this.animKeys.length)&&this.animKeys[s].time>e){a=this.animKeys[s];break}if(s===this.animKeys.length-1&&this.animKeys[s].time<=e){a=this.animKeys[s];break}if(this.animKeys[s].time<=e&&(s+1>=this.animKeys.length||this.animKeys[s+1].time>e)){a=this.animKeys[s];break}}var o=i;return o.copy(a),o.time=e,o._cacheKeyIdx=s,o},AnimationCurve.prototype.evalCUBIC=function(t){if(!this.animKeys||0===this.animKeys.length)return null;for(var i,n,s,a,r=new AnimationKeyable,o=0;o<this.animKeys.length;o++){if(this.animKeys[o].time===t)return r.copy(this.animKeys[o]),r;if(this.animKeys[o].time>t){s=this.animKeys[o],o+1<this.animKeys.length&&(a=this.animKeys[o+1]);break}n=this.animKeys[o],o-1>=0&&(i=this.animKeys[o-1])}return n&&s?n.type==e.NUM||n.type==e.VEC?((r=AnimationCurve.cubicCardinal(i,n,s,a,t,this.tension)).time=t,r):null:(r.copy(n||s),r.time=t,r)},AnimationCurve.prototype.evalCUBIC_cache=function(t,i,n){if(!this.animKeys||0===this.animKeys.length)return null;var s=0;i&&(s=i);for(var a,r,o,h,l=s,u=n,c=0;c<this.animKeys.length;c++){if(l=(s+c)%this.animKeys.length,this.animKeys[l].time===t)return u.copy(this.animKeys[l]),u._cacheKeyIdx=l,u;if(0===l&&this.animKeys[l].time>t){a=null,r=null,o=this.animKeys[l],l+1<this.animKeys.length&&(h=this.animKeys[l+1]);break}if(l==this.animKeys.length-1&&this.animKeys[l].time<t){l-1>0&&(a=this.animKeys[l-1]),r=this.animKeys[l],o=null,h=null;break}if(this.animKeys[l].time>t&&(l-1<0||this.animKeys[l-1].time<t)){l-2>0&&(a=this.animKeys[l-2]),r=this.animKeys[l-1],o=this.animKeys[l],l+1<this.animKeys.length&&(h=this.animKeys[l+1]);break}}return r&&o?r.type==e.NUM||r.type==e.VEC?((u=AnimationCurve.cubicCardinal(a,r,o,h,t,this.tension)).time=t,u._cacheKeyIdx=l,u):null:(u.copy(r||o),u.time=t,u._cacheKeyIdx=l,u)},AnimationCurve.prototype.evalCUBICSPLINE_GLTF=function(t){if(!this.animKeys||0===this.animKeys.length)return null;for(var i,n,s=new AnimationKeyable,a=0;a<this.animKeys.length;a++){if(this.animKeys[a].time===t)return s.copy(this.animKeys[a]),s;if(this.animKeys[a].time>t){n=this.animKeys[a];break}i=this.animKeys[a]}if(!i||!n)return s.copy(i||n),s.time=t,s;var r=(t-i.time)/(n.time-i.time),o=n.time-i.time;return this.keyableType===e.NUM?s.value=AnimationCurve.cubicHermite(o*i.outTangent,i.value,o*n.inTangent,n.value,r):this.keyableType===e.VEC?(s.value.x=AnimationCurve.cubicHermite(o*i.outTangent.x,i.value.x,o*n.inTangent.x,n.value.x,r),s.value.y=AnimationCurve.cubicHermite(o*i.outTangent.y,i.value.y,o*n.inTangent.y,n.value.y,r),s.value.z=AnimationCurve.cubicHermite(o*i.outTangent.z,i.value.z,o*n.inTangent.z,n.value.z,r)):this.keyableType===e.QUAT&&(s.value.w=AnimationCurve.cubicHermite(o*i.outTangent.w,i.value.w,o*n.inTangent.w,n.value.w,r),s.value.x=AnimationCurve.cubicHermite(o*i.outTangent.x,i.value.x,o*n.inTangent.x,n.value.x,r),s.value.y=AnimationCurve.cubicHermite(o*i.outTangent.y,i.value.y,o*n.inTangent.y,n.value.y,r),s.value.z=AnimationCurve.cubicHermite(o*i.outTangent.z,i.value.z,o*n.inTangent.z,n.value.z,r),s.value.normalize()),s.time=t,s},AnimationCurve.prototype.evalCUBICSPLINE_GLTF_cache=function(t,i,n){if(!this.animKeys||0===this.animKeys.length)return null;var s=0;i&&(s=i);for(var a,r,o=s,h=n,l=0;l<this.animKeys.length;l++){if(o=(s+l)%this.animKeys.length,this.animKeys[o].time===t)return h.copy(this.animKeys[o]),h._cacheKeyIdx=o,h;if(0===o&&this.animKeys[o].time>t){a=null,r=this.animKeys[o];break}if(o===this.animKeys.length-1&&this.animKeys[o].time<t){a=this.animKeys[o],r=null;break}if(this.animKeys[o].time>t&&(o-1<0||this.animKeys[o-1].time<t)){a=this.animKeys[o-1],r=this.animKeys[o];break}}if(!a||!r)return h.copy(a||r),h.time=t,h._cacheKeyIdx=o,h;var u=(t-a.time)/(r.time-a.time),c=r.time-a.time;return this.keyableType===e.NUM?h.value=AnimationCurve.cubicHermite(c*a.outTangent,a.value,c*r.inTangent,r.value,u):this.keyableType===e.VEC?(h.value.x=AnimationCurve.cubicHermite(c*a.outTangent.x,a.value.x,c*r.inTangent.x,r.value.x,u),h.value.y=AnimationCurve.cubicHermite(c*a.outTangent.y,a.value.y,c*r.inTangent.y,r.value.y,u),h.value.z=AnimationCurve.cubicHermite(c*a.outTangent.z,a.value.z,c*r.inTangent.z,r.value.z,u)):this.keyableType===e.QUAT&&(h.value.w=AnimationCurve.cubicHermite(c*a.outTangent.w,a.value.w,c*r.inTangent.w,r.value.w,u),h.value.x=AnimationCurve.cubicHermite(c*a.outTangent.x,a.value.x,c*r.inTangent.x,r.value.x,u),h.value.y=AnimationCurve.cubicHermite(c*a.outTangent.y,a.value.y,c*r.inTangent.y,r.value.y,u),h.value.z=AnimationCurve.cubicHermite(c*a.outTangent.z,a.value.z,c*r.inTangent.z,r.value.z,u),h.value.normalize()),h.time=t,h._cacheKeyIdx=o,h},AnimationCurve.prototype.eval_cache=function(i,n,s){if(!this.animKeys||0===this.animKeys.length)return null;switch(this.type){case t.LINEAR:return this.evalLINEAR_cache(i,n,s);case t.STEP:return this.evalSTEP_cache(i,n,s);case t.CUBIC:return this.keyableType==e.QUAT?this.evalLINEAR_cache(i,n,s):this.evalCUBIC_cache(i,n,s);case t.CUBICSPLINE_GLTF:return this.evalCUBICSPLINE_GLTF_cache(i,n,s)}return null},AnimationCurve.prototype.eval=function(i){if(!this.animKeys||0===this.animKeys.length)return null;switch(this.type){case t.LINEAR:return this.evalLINEAR(i);case t.STEP:return this.evalSTEP(i);case t.CUBIC:return this.keyableType==e.QUAT?this.evalLINEAR(i):this.evalCUBIC(i);case t.CUBICSPLINE_GLTF:return this.evalCUBICSPLINE_GLTF(i)}return null},AnimationCurve.cubicHermite=function(e,t,i,n,s){var a=s*s,r=a*s;return t*(2*r-3*a+1)+n*(-2*r+3*a)+e*(r-2*a+s)+i*(r-a)},AnimationCurve.cubicCardinal=function(t,i,n,s,a,r,o){var h,l;if(!i||!n||i.type!=n.type)return null;if(i.type!=e.NUM&&i.type!=e.VEC)return null;var u,c=(a-i.time)/(n.time-i.time);u=o||new AnimationKeyable(i.type);var p=r*(n.time-i.time);if(i.type===e.NUM&&(h=p*(n.value-i.value)/(n.time-i.time),t&&(h=2*p*(n.value-t.value)/(n.time-t.time)),l=p*(n.value-i.value)/(n.time-i.time),s&&(l=2*p*(s.value-i.value)/(s.time-i.time)),u.value=AnimationCurve.cubicHermite(h,i.value,l,n.value,c)),i.type===e.VEC){u.value=i.value.clone();for(var m=["x","y","z","w"],y=0;y<m.length;y++){var v=m[y];void 0!==u.value[v]&&(h=p*(n.value[v]-i.value[v])/(n.time-i.time),t&&(h=2*p*(n.value[v]-t.value[v])/(n.time-t.time)),l=p*(n.value[v]-i.value[v])/(n.time-i.time),s&&(l=2*p*(s.value[v]-i.value[v])/(s.time-i.time)),u.value[v]=AnimationCurve.cubicHermite(h,i.value[v],l,n.value[v],c))}}return u};var AnimationClipSnapshot=function(){this.curveKeyable={},this.curveNames=[]};AnimationClipSnapshot.prototype.copy=function(e){if(!e)return this;this.curveKeyable={},this.curveNames=[];for(var t=0;t<e.curveNames.length;t++){var i=e.curveNames[t];this.curveKeyable[i]=(new AnimationKeyable).copy(e.curveKeyable[i]),this.curveNames.push(i)}return this},AnimationClipSnapshot.prototype.clone=function(){return(new AnimationClipSnapshot).copy(this)},AnimationClipSnapshot.linearBlend=function(e,t,i){if(!e||!t)return null;if(0===i)return e;if(1===i)return t;var n=new AnimationClipSnapshot;n.copy(e);for(var s=0;s<t.curveNames.length;s++){var a=t.curveNames[s];if(e.curveKeyable[a]&&t.curveKeyable[a]){var r=AnimationKeyable.linearBlend(e.curveKeyable[a],t.curveKeyable[a],i);n.curveKeyable[a]=r}else e.curveKeyable[a]?n.curveKeyable[a]=e.curveKeyable[a]:t.curveKeyable[a]&&(n.curveKeyable[a]=t.curveKeyable[a])}return n},AnimationClipSnapshot.linearBlendExceptStep=function(e,i,n,s){if(!e||!i)return null;if(0===n)return e;if(1===n)return i;var a=new AnimationClipSnapshot;a.copy(e);for(var r=0;r<i.curveNames.length;r++){var o=i.curveNames[r];if(e.curveKeyable[o]&&i.curveKeyable[o])if(s[o]&&s[o].type===t.STEP)a.curveKeyable[o]=n>.5?i.curveKeyable[o]:e.curveKeyable[o];else{var h=AnimationKeyable.linearBlend(e.curveKeyable[o],i.curveKeyable[o],n);a.curveKeyable[o]=h}else e.curveKeyable[o]?a.curveKeyable[o]=e.curveKeyable[o]:i.curveKeyable[o]&&(a.curveKeyable[o]=i.curveKeyable[o])}return a};var AnimationClip=function(e){AnimationClip.count++,this.name="clip"+AnimationClip.count.toString(),this.duration=0,this.animCurvesMap={},this.animCurves=[],this.root=null,e&&(this.root=e,this.constructFromRoot(e)),this.session=new i(this)};AnimationClip.count=0,Object.defineProperty(AnimationClip.prototype,"isPlaying",{get:function(){return this.session.isPlaying},set:function(e){this.session.isPlaying=e}}),Object.defineProperty(AnimationClip.prototype,"loop",{get:function(){return this.session.loop},set:function(e){this.session.loop=e}}),Object.defineProperty(AnimationClip.prototype,"bySpeed",{get:function(){return this.session.bySpeed},set:function(e){this.session.bySpeed=e}}),AnimationClip.prototype.copy=function(e){this.name=e.name,this.duration=e.duration,this.animCurves.length=0,this.animCurvesMap={};for(var t=0,i=e.animCurves.length;t<i;t++){var n=e.animCurves[t];this.addCurve(n.clone())}return this},AnimationClip.prototype.clone=function(){return(new AnimationClip).copy(this)},AnimationClip.prototype.updateDuration=function(){this.duration=0;for(var e=0,t=this.animCurves.length;e<t;e++){var i=this.animCurves[e];this.duration=Math.max(this.duration,i.duration)}},AnimationClip.prototype.showAt=function(e,t,i,n,s){this.session.showAt(e,t,i,n,s)},AnimationClip.prototype.blendToTarget=function(e,t){this.session.blendToTarget(e,t)},AnimationClip.prototype.updateToTarget=function(e){this.session.updateToTarget(e)},AnimationClip.prototype.getAnimTargets=function(){for(var e={},t=0,i=this.animCurves.length;t<i;t++){var n=this.animCurves[t],s=n.getAnimTargets();e[n.name]=s[n.name]}return e},AnimationClip.prototype.resetSession=function(){this.session.playable=this,this.session.animTargets=this.getAnimTargets(),this.session.isPlaying=!0,this.session.begTime=0,this.session.endTime=this.duration,this.session.curTime=0,this.session.bySpeed=1,this.session.loop=!0},AnimationClip.prototype.play=function(){this.session.play(this)},AnimationClip.prototype.stop=function(){this.session.stop()},AnimationClip.prototype.pause=function(){this.session.pause()},AnimationClip.prototype.resume=function(){this.session.resume()},AnimationClip.prototype.fadeIn=function(e){this.session.fadeIn(e,this)},AnimationClip.prototype.fadeOut=function(e){this.session.fadeOut(e)},AnimationClip.prototype.fadeTo=function(e,t){this.session.fadeTo(e,t)},AnimationClip.prototype.addCurve=function(e){e&&e.name&&(this.animCurves.push(e),this.animCurvesMap[e.name]=e,e.duration>this.duration&&(this.duration=e.duration))},AnimationClip.prototype.removeCurve=function(e){if(e){var t=this.animCurvesMap[e];if(t){var i=this.animCurves.indexOf(t);-1!==i&&this.animCurves.splice(i,1),delete this.animCurvesMap[e],this.updateDuration()}}},AnimationClip.prototype.removeAllCurves=function(){this.animCurves.length=0,this.animCurvesMap={},this.duration=0},AnimationClip.prototype.on=function(e,t,i,n,s){return this.session&&this.session.on(e,t,i,n,s),this},AnimationClip.prototype.off=function(e,t,i){return this.session&&this.session.off(e,t,i),this},AnimationClip.prototype.removeAllEvents=function(){return this.session&&this.session.removeAllEvents(),this},AnimationClip.prototype.getSubClip=function(e,t){var i=new AnimationClip;i.name=this.name+"_sub",i.root=this.root;for(var n=0,s=this.animCurves.length;n<s;n++){var a=this.animCurves[n].getSubCurve(e,t);i.addCurve(a)}return i},AnimationClip.prototype.eval_cache=function(e,t,i){if(!i){var n=this.eval();return n._cacheKeyIdx=t,n}var s=i;s.time=e;for(var a=0,r=this.animCurves.length;a<r;a++){var o,h,l=this.animCurves[a];t&&(o=t[l.name]),h=i?i.curveKeyable[l.name]:new AnimationKeyable(l.keyableType);var u=l.eval_cache(e,o,h);t&&u&&(t[l.name]=u._cacheKeyIdx),s.curveKeyable[l.name]=u}return s._cacheKeyIdx=t,s},AnimationClip.prototype.eval=function(e){var t=new AnimationClipSnapshot;t.time=e;for(var i=0,n=this.animCurves.length;i<n;i++){var s=this.animCurves[i],a=s.eval(e);t.curveKeyable[s.name]=a,t.curveNames.push(s.name)}return t},AnimationClip.prototype.constructFromRoot=function(t){if(t){var i=new AnimationCurve;i.keyableType=e.VEC,i.name=t.name+".localScale",i.setTarget(t,"localScale"),this.addCurve(i);var n=new AnimationCurve;n.keyableType=e.VEC,n.name=t.name+".localPosition",n.setTarget(t,"localPosition"),this.addCurve(n);var s=new AnimationCurve;s.name=t.name+".localRotation.quat",s.keyableType=e.QUAT,s.setTarget(t,"localRotation"),this.addCurve(s);for(var a=0;a<t.children.length;a++)t.children[a]&&this.constructFromRoot(t.children[a])}},AnimationClip.prototype.transferToRoot=function(e){var t=new pc.Vec3,i={};AnimationTarget.constructTargetNodes(e,null,i);for(var n=0,s=this.animCurves.length;n<s;n++){var a=this.animCurves[n];if(0!==a.animTargets.length){"model"===a.animTargets[0].targetNode&&(a.animTargets[0].targetNode=e);var r=a.animTargets[0],o=i[r.targetNode.name];o&&(AnimationTarget.getLocalScale(r.targetNode,t),r.targetNode=o.targetNode,o.vScale&&(r.vScale=t.clone(),o.vScale.x&&(r.vScale.x/=o.vScale.x),o.vScale.y&&(r.vScale.y/=o.vScale.y),o.vScale.z&&(r.vScale.z/=o.vScale.z)))}}},AnimationClip.prototype.updateCurveNameFromTarget=function(){for(var e=0,t=this.animCurves.length;e<t;e++){var i=this.animCurves[e];if(i.animTargets&&!(i.animTargets.length<1)){var n=i.name,s=i.animTargets[0].toString();n!=s&&(i.name=s,delete this.animCurvesMap[n],this.animCurvesMap[s]=i)}}},AnimationClip.prototype.removeEmptyCurves=function(){for(var e=0,t=this.animCurves.length;e<t;e++){var i=this.animCurves[e];i&&i.animKeys&&0!==i.animKeys.length||this.removeCurve(i.name)}},AnimationClip.prototype.setInterpolationType=function(e){for(var t=0,i=this.animCurves.length;t<i;t++){var n=this.animCurves[t];n&&(n.type=e)}};var AnimationEvent=function(e,t,i,n,s){this.name=e,this.triggerTime=t,this.fnCallback=i,this.context=n||this,this.parameter=s,this.triggered=!1};AnimationEvent.prototype.invoke=function(){this.fnCallback&&(this.fnCallback.call(this.context,this.parameter),this.triggered=!0)};var i=function AnimationSession(e,t){this._cacheKeyIdx=void 0,this._cacheValue=void 0,this._cacheBlendValues={},this.begTime=-1,this.endTime=-1,this.curTime=0,this.accTime=0,this.bySpeed=1,this.isPlaying=!1,this.loop=!1,this.fadeBegTime=-1,this.fadeEndTime=-1,this.fadeTime=-1,this.fadeDir=0,this.fadeSpeed=1,this.playable=null,this.animTargets={},e&&(this.playable=e,this.allocateCache(),t||(this.animTargets=e.getAnimTargets())),t&&(this.animTargets=t),this.animEvents=[],this.blendables={},this.blendWeights={};var i=this;this.onTimer=function(e){if(i.curTime+=i.bySpeed*e,i.accTime+=i.bySpeed*e,!i.isPlaying||!i.loop&&(i.curTime<i.begTime||i.curTime>i.endTime))return i.invokeByTime(i.curTime),i.stop(),void i.invokeByName("stop");var t=i.endTime-i.begTime;if(i.curTime>i.endTime){i.invokeByTime(i.curTime),i.curTime-=t;for(var n=0;n<i.animEvents.length;n++)i.animEvents[n].triggered=!1}if(i.curTime<i.begTime&&(i.curTime+=t),i.fadeDir&&(i.fadeTime+=e,i.fadeTime>=i.fadeEndTime))if(1===i.fadeDir)i.fadeDir=0,i.fadeBegTime=-1,i.fadeEndTime=-1,i.fadeTime=-1;else if(-1===i.fadeDir)return void i.stop();i.showAt(i.curTime,i.fadeDir,i.fadeBegTime,i.fadeEndTime,i.fadeTime),i.invokeByTime(i.curTime)}};i._allocatePlayableCache=function(e){if(!e)return null;if(e instanceof AnimationCurve)return new AnimationKeyable(e.keyableType);if(e instanceof AnimationClip){for(var t=new AnimationClipSnapshot,i=0,n=e.animCurves.length;i<n;i++){var s=e.animCurves[i].name;t.curveKeyable[s]=new AnimationKeyable(e.animCurves[i].keyableType),t.curveNames.push(s)}return t}return null},i.prototype.allocateCache=function(){this.playable&&(this.playable instanceof AnimationCurve?this._cacheKeyIdx=0:this.playable instanceof AnimationClip&&(this._cacheKeyIdx={}),this._cacheValue=i._allocatePlayableCache(this.playable))},i.prototype.clone=function(){var e,t,n=new i;for(t in n.begTime=this.begTime,n.endTime=this.endTime,n.curTime=this.curTime,n.accTime=this.accTime,n.speed=this.speed,n.loop=this.loop,n.isPlaying=this.isPlaying,n.fadeBegTime=this.fadeBegTime,n.fadeEndTime=this.fadeEndTime,n.fadeTime=this.fadeTime,n.fadeDir=this.fadeDir,n.fadeSpeed=this.fadeSpeed,n.playable=this.playable,n.allocateCache(),n.animTargets={},this.animTargets)if(this.animTargets.hasOwnProperty(t)){var s=this.animTargets[t],a=[];for(e=0;e<s.length;e++)a.push(s[e].clone());n.animTargets[t]=a}for(n.animEvents=[],e=0;e<this.animEvents.length;e++)n.animEvents.push(this.animEvents[e].clone());for(t in n.blendables={},this.blendables)this.blendables.hasOwnProperty(t)&&(n.blendables[t]=this.blendables[t],n._cacheBlendValues[t]=i._allocatePlayableCache(this.blendables[t]));for(t in n.blendWeights={},this.blendWeights)this.blendWeights.hasOwnProperty(t)&&(n.blendWeights[t]=this.blendWeights[t]);return n},i.prototype.setBlend=function(t,n,s){if(t instanceof AnimationClip)return s&&""!==s||(s="__default__"),this.blendables[s]=t,this._cacheBlendValues[s]=i._allocatePlayableCache(t),void(this.blendWeights[s]=n);var a;"number"==typeof t?a=e.NUM:t instanceof pc.Vec3?a=e.VEC:t instanceof pc.Quat&&(a=e.QUAT),s&&""!==s&&void 0!==a&&(this.blendWeights[s]=n,this.blendables[s]=new AnimationKeyable(a,0,t),this._cacheBlendValues[s]=null)},i.prototype.unsetBlend=function(e){e&&""!==e||(e="__default__"),this.blendables[e]&&(delete this.blendables[e],delete this._cacheBlendValues[e],delete this.blendWeights[e])},i.prototype.on=function(e,t,i,n,s){if(e&&i){for(var a=new AnimationEvent(e,t,i,n,s),r=0;r<this.animEvents.length&&!(this.animEvents[r].triggerTime>t);r++);r>=this.animEvents.length?this.animEvents.push(a):this.animEvents.splice(r,0,a)}},i.prototype.off=function(e,t,i){for(var n=0;n<this.animEvents.length;n++){var s=this.animEvents[n];if(s){if(s.name===e&&s.fnCallback===i)break;if(s.triggerTime===t&&s.fnCallback===i)break}}n<this.animEvents.length&&this.animEvents.splice(n,1)},i.prototype.removeAllEvents=function(){this.animEvents=[]},i.prototype.invokeByName=function(e){for(var t=0;t<this.animEvents.length;t++)this.animEvents[t]&&this.animEvents[t].name===e&&this.animEvents[t].invoke()},i.prototype.invokeByTime=function(e){for(var t=0;t<this.animEvents.length;t++)if(this.animEvents[t]){if(this.animEvents[t].triggerTime>e)break;this.animEvents[t].triggered||this.animEvents[t].invoke()}},i.prototype.blendToTarget=function(e,i){var n,s,a,r,o,h=0,l=1,u=2;if(!(!e||i>1||i<=0))if(1!==i){if(this.playable instanceof AnimationCurve&&e instanceof AnimationKeyable){if(a=this.playable.name,!(r=this.animTargets[a]))return;for(o=h,this.playable.type===t.STEP&&this.fadeDir&&(o=-1==this.fadeDir&&i<=.5||1==this.fadeDir&&i>.5?l:u),s=0;s<r.length;s++)o===h?r[s].blendToTarget(e.value,i):o===l&&r[s].updateToTarget(e.value)}else if(this.playable instanceof AnimationClip&&e instanceof AnimationClipSnapshot)for(n=0;n<e.curveNames.length;n++)if((a=e.curveNames[n])&&(o=h,this.playable.animCurvesMap[a]&&this.playable.animCurvesMap[a].type===t.STEP&&this.fadeDir&&(o=-1==this.fadeDir&&i<=.5||1==this.fadeDir&&i>.5?l:u),r=this.animTargets[a]))for(s=0;s<r.length;s++)o===h?r[s].blendToTarget(e.curveKeyable[a].value,i):o===l&&r[s].updateToTarget(e.value)}else this.updateToTarget(e)},i.prototype.updateToTarget=function(e){var t,i,n,s;if(e)if(this.playable instanceof AnimationCurve&&e instanceof AnimationKeyable){if(n=this.playable.name,!(s=this.animTargets[n]))return;for(i=0;i<s.length;i++)s[i].updateToTarget(e.value)}else if(this.playable instanceof AnimationClip&&e instanceof AnimationClipSnapshot)for(t=0;t<e.curveNames.length;t++)if((n=e.curveNames[t])&&(s=this.animTargets[n]))for(i=0;i<s.length;i++)e.curveKeyable[n]&&s[i].updateToTarget(e.curveKeyable[n].value)},i.prototype.showAt=function(e,t,i,n,s){var a,r=this.playable.eval_cache(e,this._cacheKeyIdx,this._cacheValue);for(var o in r&&(this._cacheKeyIdx=r._cacheKeyIdx),this.blendables)if(this.blendables.hasOwnProperty(o)){a=this.blendWeights[o];var h=this.blendables[o];if(h&&h instanceof AnimationClip&&"number"==typeof a){var l=h.eval_cache(this.accTime%h.duration,null,this._cacheBlendValues[o]);r=AnimationClipSnapshot.linearBlendExceptStep(r,l,a,this.playable.animCurvesMap)}}for(var u in this.blendables)if(this.blendables.hasOwnProperty(u)){a=this.blendWeights[u];var c=this.blendables[u];if(c&&r.curveKeyable[u]&&!(c instanceof AnimationClip)){var p=AnimationKeyable.linearBlend(r.curveKeyable[u],c,a);r.curveKeyable[u]=p}}0===t||s<i||s>n?this.updateToTarget(r):(a=(s-i)/(n-i),-1===t&&(a=1-a),this.fadeSpeed<1&&-1===t&&(a*=this.fadeSpeed),this.blendToTarget(r,a))},i.prototype.play=function(e,t){var i;if(e&&(this.playable=e,this.allocateCache()),!(this.playable instanceof AnimationClip||this.playable instanceof AnimationCurve))return this;if(this.isPlaying)return this;for(this.begTime=0,this.endTime=this.playable.duration,this.curTime=0,this.accTime=0,this.isPlaying=!0,e&&this!==e.session&&(this.bySpeed=e.bySpeed,this.loop=e.loop),!t&&e&&"function"==typeof e.getAnimTargets?this.animTargets=e.getAnimTargets():t&&(this.animTargets=t),i=0;i<this.animEvents.length;i++)this.animEvents[i].triggered=!1;return pc.Application.getApplication().on("update",this.onTimer),this.showAt(this.curTime,this.fadeDir,this.fadeBegTime,this.fadeEndTime,this.fadeTime),this},i.prototype.stop=function(){return pc.Application.getApplication().off("update",this.onTimer),this.curTime=0,this.isPlaying=!1,this.fadeBegTime=-1,this.fadeEndTime=-1,this.fadeTime=-1,this.fadeDir=0,this.fadeSpeed=1,this},i.prototype.pause=function(){return pc.Application.getApplication().off("update",this.onTimer),this.isPlaying=!1,this},i.prototype.resume=function(){this.isPlaying||(this.isPlaying=!0,pc.Application.getApplication().on("update",this.onTimer))},i.prototype.fadeOut=function(e){if(0===this.fadeDir)this.fadeSpeed=1;else{if(1!==this.fadeDir)return;this.fadeSpeed=(this.fadeTime-this.fadeBegTime)/(this.fadeEndTime-this.fadeBegTime)}"number"!=typeof e&&(e=0),this.fadeBegTime=this.curTime,this.fadeTime=this.fadeBegTime,this.fadeEndTime=this.fadeBegTime+e,this.fadeDir=-1},i.prototype.fadeIn=function(e,t){this.isPlaying&&this.stop(),this.fadeSpeed=0,this.curTime=0,"number"!=typeof e&&(e=0),this.fadeBegTime=this.curTime,this.fadeTime=this.fadeBegTime,this.fadeEndTime=this.fadeBegTime+e,this.fadeDir=1,t&&(this.playable=t,this.allocateCache()),this.play(t)},i.prototype.fadeTo=function(e,t){this.fadeOut(t);var n=new i;return n.fadeIn(t,e),n},i.prototype.fadeToSelf=function(e){var t=this.clone();pc.Application.getApplication().off("update",this.onTimer),t.fadeOut(e),this.stop(),this.fadeIn(e)};var AnimationComponent=function(){this.name="",this.animClipsMap={},this.animClips=[],this.curClip="",this.animSessions={}};return AnimationComponent.prototype.clipCount=function(){return this.animClips.length},AnimationComponent.prototype.getCurrentClip=function(){return this.animClipsMap[this.curClip]},AnimationComponent.prototype.clipAt=function(e){return this.animClips.length<=e?null:this.animClips[e]},AnimationComponent.prototype.addClip=function(e){e&&e.name&&(this.animClips.push(e),this.animClipsMap[e.name]=e)},AnimationComponent.prototype.removeClip=function(e){var t=this.animClipsMap[e];if(t){var i=this.animClips.indexOf(t);-1!==i&&this.animClips.splice(i,1),delete this.animClipsMap[e]}this.curClip===e&&(this.curClip="")},AnimationComponent.prototype.playClip=function(e){var t=this.animClipsMap[e];t&&(this.curClip=e,t.play())},AnimationComponent.prototype.stopClip=function(){var e=this.animSessions[this.curClip];e&&e.stop();var t=this.animClipsMap[this.curClip];t&&t.stop(),this.curClip=""},AnimationComponent.prototype.crossFadeToClip=function(e,t){var i=this.animClipsMap[this.curClip],n=this.animClipsMap[e];i&&n?(i.fadeOut(t),n.fadeIn(t),this.curClip=e):i?(i.fadeOut(t),this.curClip=""):n&&(n.fadeIn(t),this.curClip=e)},AnimationComponent.prototype.setBlend=function(e,t,i){var n=this.getCurrentClip();n&&n.session&&n.session.setBlend(e,t,i)},AnimationComponent.prototype.unsetBlend=function(e){var t=this.getCurrentClip();t&&t.session&&t.session.unsetBlend(e)},AnimationComponent.prototype.getCurrentSession=function(){return this.animSessions[this.curClip]},AnimationComponent.prototype.playSession=function(e){var t=this.animSessions[e];t&&(t.play(),this.curClip=e)},AnimationComponent.prototype.stopSession=function(){var e=this.animSessions[this.curClip];e&&e.stop();var t=this.animClipsMap[this.curClip];t&&t.stop(),this.curClip=""},AnimationComponent.prototype.crossFadeToSession=function(e,t){var i=this.animSessions[this.curClip],n=this.animSessions[e];i&&this.animSessions[e]?(i.fadeOut(t),n.fadeIn(t),this.curClip=e):i?(i.fadeOut(t),this.curClip=""):n&&(n.fadeIn(t),this.curClip=e)},AnimationComponent.prototype.setBlendSession=function(e,t,i){var n=this.animSessions[this.curClip];n&&n.setBlend(e,t,i)},AnimationComponent.prototype.unsetBlendSession=function(e){var t=this.animSessions[this.curClip];t&&t.unsetBlend(e)},AnimationComponent.prototype.playSubstring=function(e){for(var t=this.animClips.length,i=0;i<t;i++){var n=this.animClips[i];n.isPlaying&&n.pause(),-1!==n.name.indexOf(e)&&n.play()}},AnimationComponent.prototype.pauseAll=function(){for(var e=this.animClips.length,t=0;t<e;t++){var i=this.animClips[t];i.isPlaying&&i.pause()}},{AnimationKeyableType:e,AnimationKeyable:AnimationKeyable,AnimationTarget:AnimationTarget,AnimationCurveType:t,AnimationCurve:AnimationCurve,AnimationClipSnapshot:AnimationClipSnapshot,AnimationClip:AnimationClip,AnimationEvent:AnimationEvent,AnimationSession:i,AnimationComponent:AnimationComponent}}());Object.assign(window,function(){function nearestPow2(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function isPowerOf2(e){return e&&0==(e&e-1)}function getFilter(e){var r=pc.FILTER_LINEAR;switch(e){case 9728:r=pc.FILTER_NEAREST;break;case 9729:r=pc.FILTER_LINEAR;break;case 9984:r=pc.FILTER_NEAREST_MIPMAP_NEAREST;break;case 9985:r=pc.FILTER_LINEAR_MIPMAP_NEAREST;break;case 9986:r=pc.FILTER_NEAREST_MIPMAP_LINEAR;break;case 9987:r=pc.FILTER_LINEAR_MIPMAP_LINEAR}return r}function getWrap(e){var r=pc.ADDRESS_REPEAT;switch(e){case 33071:r=pc.ADDRESS_CLAMP_TO_EDGE;break;case 33648:r=pc.ADDRESS_MIRRORED_REPEAT;break;case 10497:r=pc.ADDRESS_REPEAT}return r}function isDataURI(e){return/^data:.*,.*$/i.test(e)}function getAccessorData(e,r,s){var t=e.bufferViews[r.bufferView],a=s[t.buffer],n=(r.hasOwnProperty("byteOffset")?r.byteOffset:0)+(t.hasOwnProperty("byteOffset")?t.byteOffset:0),o=r.count*function getAccessorTypeSize(e){var r=3;switch(e){case"SCALAR":r=1;break;case"VEC2":r=2;break;case"VEC3":r=3;break;case"VEC4":case"MAT2":r=4;break;case"MAT3":r=9;break;case"MAT4":r=16}return r}(r.type),i=null;switch(r.componentType){case 5120:i=new Int8Array(a,n,o);break;case 5121:i=new Uint8Array(a,n,o);break;case 5122:i=new Int16Array(a,n,o);break;case 5123:i=new Uint16Array(a,n,o);break;case 5125:i=new Uint32Array(a,n,o);break;case 5126:i=new Float32Array(a,n,o)}return i}function translateAnimation(e,r){var s=new AnimationClip;s.loop=!0,e.hasOwnProperty("name")&&(s.name=e.name);var t=r.gltf;return e.channels.forEach((function(a){var n,o,i,c,p,f,l,u,d=e.samplers[a.sampler],h=getAccessorData(t,t.accessors[d.input],r.buffers),w=getAccessorData(t,t.accessors[d.output],r.buffers),O=a.target,y=O.path,T=r.nodes[O.node];if("weights"===y){var m=w.length/h.length;for(l=0;l<m;l++){for(p=new AnimationCurve,f=AnimationKeyableType.NUM,p.keyableType=f,p.addTarget("model",y,l),"CUBIC"===d.interpolation?p.type=AnimationCurveType.CUBIC:"STEP"===d.interpolation&&(p.type=AnimationCurveType.STEP),u=0;u<h.length;u++)n=h[u],o=w[m*u+l],p.insertKey(f,n,o);s.addCurve(p)}}else{f=AnimationKeyableType.NUM;var E=y;switch(y){case"translation":f=AnimationKeyableType.VEC,E="localPosition";break;case"scale":f=AnimationKeyableType.VEC,E="localScale";break;case"rotation":f=AnimationKeyableType.QUAT,E="localRotation"}(p=new AnimationCurve).keyableType=f,p.setTarget(T,E),"CUBIC"===d.interpolation?p.type=AnimationCurveType.CUBIC:"STEP"===d.interpolation?p.type=AnimationCurveType.STEP:"CUBICSPLINE"===d.interpolation&&(p.type=AnimationCurveType.CUBICSPLINE_GLTF);var P,M=[];if("CUBICSPLINE"===d.interpolation)for(l=0;l<h.length;l++)n=h[l],"translation"===y||"scale"===y?(i=new pc.Vec3(w[9*l+0],w[9*l+1],w[9*l+2]),o=new pc.Vec3(w[9*l+3],w[9*l+4],w[9*l+5]),c=new pc.Vec3(w[9*l+6],w[9*l+7],w[9*l+8])):"rotation"===y?(i=new pc.Quat(w[12*l+0],w[12*l+1],w[12*l+2],w[12*l+3]),o=new pc.Quat(w[12*l+4],w[12*l+5],w[12*l+6],w[12*l+7]),c=new pc.Quat(w[12*l+8],w[12*l+9],w[12*l+10],w[12*l+11])):(i=w[3*l],o=w[3*l+1],c=w[3*l+2]),(P=new AnimationKeyable(f,n,o)).inTangent=i,P.outTangent=c,M.push(P);else for(l=0;l<h.length;l++)n=h[l],o="translation"===y||"scale"===y?new pc.Vec3(w[3*l+0],w[3*l+1],w[3*l+2]):"rotation"===y?new pc.Quat(w[4*l+0],w[4*l+1],w[4*l+2],w[4*l+3]):w[l],P=new AnimationKeyable(f,n,o),M.push(P);p.animKeys=M,p.duration=n,s.addCurve(p)}})),e.hasOwnProperty("extras")&&r.processAnimationExtras&&r.processAnimationExtras(s,e.extras),s}function translateImage(e,r,s){var t=new Image,onLoad=function(){t.removeEventListener("load",onLoad,!1);var e=r.gltf,a=r.images.indexOf(t);e.textures.forEach((function(e,s){if(e.hasOwnProperty("source")&&e.source===a){var n=r.textures[s];if(isPowerOf2(t.width)&&isPowerOf2(t.width)||n.addressU!==pc.ADDRESS_REPEAT&&n.addressU!==pc.ADDRESS_MIRRORED_REPEAT&&n.addressV!==pc.ADDRESS_REPEAT&&n.addressV!==pc.ADDRESS_MIRRORED_REPEAT&&n.minFilter!==pc.FILTER_LINEAR_MIPMAP_LINEAR&&n.minFilter!==pc.FILTER_NEAREST_MIPMAP_LINEAR&&n.minFilter!==pc.FILTER_LINEAR_MIPMAP_NEAREST&&n.minFilter!==pc.FILTER_NEAREST_MIPMAP_NEAREST)n.setSource(t);else{var o=new Image;o.addEventListener("load",(function(){n.setSource(o)})),o.src=function resampleImage(e){var r=e.width,s=e.height,t=nearestPow2(r),a=nearestPow2(s),n=document.createElement("canvas");return n.width=t,n.height=a,n.getContext("2d").drawImage(e,0,0,r,s,0,0,t,a),n.toDataURL()}(t)}}})),r.imagesLoaded++,r.imagesLoaded===e.images.length&&s()};if(t.addEventListener("load",onLoad,!1),e.hasOwnProperty("uri")&&(isDataURI(e.uri)?t.src=e.uri:r.processUri?r.processUri(e.uri,(function(e){t.crossOrigin="anonymous",t.src=e})):(t.crossOrigin="anonymous",t.src=r.basePath+e.uri)),e.hasOwnProperty("bufferView")){var a=r.gltf,n=r.buffers,o=a.bufferViews[e.bufferView],i=n[o.buffer],c=o.hasOwnProperty("byteOffset")?o.byteOffset:0,p=i.slice(c,c+o.byteLength),f=new Blob([p],{type:e.mimeType});t.src=URL.createObjectURL(f)}return t}var e=["#ifdef MAPFLOAT","uniform float material_shininess;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_glossMap;","#endif","","void getGlossiness() {","    dGlossiness = 1.0;","","#ifdef MAPFLOAT","    dGlossiness *= material_shininess;","#endif","","#ifdef MAPTEXTURE","    dGlossiness *= texture2D(texture_glossMap, $UV).$CH;","#endif","","#ifdef MAPVERTEX","    dGlossiness *= saturate(vVertexColor.$VC);","#endif","","    dGlossiness = 1.0 - dGlossiness;","","    dGlossiness += 0.0000001;","}"].join("\n"),r=["#ifdef MAPCOLOR","uniform vec3 material_specular;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_specularMap;","#endif","","void getSpecularity() {","    dSpecularity = vec3(1.0);","","    #ifdef MAPCOLOR","        dSpecularity *= material_specular;","    #endif","","    #ifdef MAPTEXTURE","        vec3 srgb = texture2D(texture_specularMap, $UV).$CH;","        dSpecularity *= vec3(pow(srgb.r, 2.2), pow(srgb.g, 2.2), pow(srgb.b, 2.2));","    #endif","","    #ifdef MAPVERTEX","        dSpecularity *= saturate(vVertexColor.$VC);","    #endif","}"].join("\n");function translateMaterial(s,t){var a,n,o=new pc.StandardMaterial;if(o.occludeSpecular=!0,o.diffuseTint=!0,o.diffuseVertexColor=!0,o.specularTint=!0,o.specularVertexColor=!0,s.hasOwnProperty("name")&&(o.name=s.name),s.hasOwnProperty("extensions")&&s.extensions.hasOwnProperty("KHR_materials_unlit")&&(o.useLighting=!1),s.hasOwnProperty("extensions")&&s.extensions.hasOwnProperty("KHR_materials_pbrSpecularGlossiness")){var i=s.extensions.KHR_materials_pbrSpecularGlossiness;if(i.hasOwnProperty("diffuseFactor")?(a=i.diffuseFactor,o.diffuse.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)),o.opacity=null!=a[3]?a[3]:1):(o.diffuse.set(1,1,1),o.opacity=1),i.hasOwnProperty("diffuseTexture")){var c=i.diffuseTexture;if(n=t.textures[c.index],o.diffuseMap=n,o.diffuseMapChannel="rgb",o.opacityMap=n,o.opacityMapChannel="a",c.hasOwnProperty("texCoord")&&(o.diffuseMapUv=c.texCoord,o.opacityMapUv=c.texCoord),c.hasOwnProperty("extensions")&&c.extensions.hasOwnProperty("KHR_texture_transform")){var p=c.extensions.KHR_texture_transform;p.hasOwnProperty("scale")&&(o.diffuseMapTiling=new pc.Vec2(p.scale[0],p.scale[1]),o.opacityMapTiling=new pc.Vec2(p.scale[0],p.scale[1])),p.hasOwnProperty("offset")&&(o.diffuseMapOffset=new pc.Vec2(p.offset[0],p.offset[1]),o.opacityMapOffset=new pc.Vec2(p.offset[0],p.offset[1]))}}if(o.useMetalness=!1,i.hasOwnProperty("specularFactor")?(a=i.specularFactor,o.specular.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2))):o.specular.set(1,1,1),i.hasOwnProperty("glossinessFactor")?o.shininess=100*i.glossinessFactor:o.shininess=100,i.hasOwnProperty("specularGlossinessTexture")){var f=i.specularGlossinessTexture;if(o.specularMap=t.textures[f.index],o.specularMapChannel="rgb",o.glossMap=t.textures[f.index],o.glossMapChannel="a",f.hasOwnProperty("texCoord")&&(o.glossMapUv=f.texCoord,o.metalnessMapUv=f.texCoord),f.hasOwnProperty("extensions")&&f.extensions.hasOwnProperty("KHR_texture_transform")){var l=f.extensions.KHR_texture_transform;l.hasOwnProperty("scale")&&(o.glossMapTiling=new pc.Vec2(l.scale[0],l.scale[1]),o.metalnessMapTiling=new pc.Vec2(l.scale[0],l.scale[1])),l.hasOwnProperty("offset")&&(o.glossMapOffset=new pc.Vec2(l.offset[0],l.offset[1]),o.metalnessMapOffset=new pc.Vec2(l.offset[0],l.offset[1]))}}o.chunks.specularPS=r}else if(s.hasOwnProperty("pbrMetallicRoughness")){var u=s.pbrMetallicRoughness;if(u.hasOwnProperty("baseColorFactor")?(a=u.baseColorFactor,o.diffuse.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)),o.opacity=a[3]):(o.diffuse.set(1,1,1),o.opacity=1),u.hasOwnProperty("baseColorTexture")){var d=u.baseColorTexture;if(n=t.textures[d.index],o.diffuseMap=n,o.diffuseMapChannel="rgb",o.opacityMap=n,o.opacityMapChannel="a",d.hasOwnProperty("texCoord")&&(o.diffuseMapUv=d.texCoord,o.opacityMapUv=d.texCoord),d.hasOwnProperty("extensions")&&d.extensions.hasOwnProperty("KHR_texture_transform")){var h=d.extensions.KHR_texture_transform;h.hasOwnProperty("scale")&&(o.diffuseMapTiling=new pc.Vec2(h.scale[0],h.scale[1]),o.opacityMapTiling=new pc.Vec2(h.scale[0],h.scale[1])),h.hasOwnProperty("offset")&&(o.diffuseMapOffset=new pc.Vec2(h.offset[0],h.offset[1]),o.opacityMapOffset=new pc.Vec2(h.offset[0],h.offset[1]))}}if(o.useMetalness=!0,u.hasOwnProperty("metallicFactor")?o.metalness=u.metallicFactor:o.metalness=1,u.hasOwnProperty("roughnessFactor")?o.shininess=100*u.roughnessFactor:o.shininess=100,u.hasOwnProperty("metallicRoughnessTexture")){var w=u.metallicRoughnessTexture;if(o.metalnessMap=t.textures[w.index],o.metalnessMapChannel="b",o.glossMap=t.textures[w.index],o.glossMapChannel="g",w.hasOwnProperty("texCoord")&&(o.glossMapUv=w.texCoord,o.metalnessMapUv=w.texCoord),w.hasOwnProperty("extensions")&&w.extensions.hasOwnProperty("KHR_texture_transform")){var O=w.extensions.KHR_texture_transform;O.hasOwnProperty("scale")&&(o.glossMapTiling=new pc.Vec2(O.scale[0],O.scale[1]),o.metalnessMapTiling=new pc.Vec2(O.scale[0],O.scale[1])),O.hasOwnProperty("offset")&&(o.glossMapOffset=new pc.Vec2(O.offset[0],O.offset[1]),o.metalnessMapOffset=new pc.Vec2(O.offset[0],O.offset[1]))}}o.chunks.glossPS=e}if(s.hasOwnProperty("normalTexture")){var y=s.normalTexture;if(o.normalMap=t.textures[y.index],y.hasOwnProperty("texCoord")&&(o.normalMapUv=y.texCoord),y.hasOwnProperty("extensions")&&y.extensions.hasOwnProperty("KHR_texture_transform")){var T=y.extensions.KHR_texture_transform;T.hasOwnProperty("scale")&&(o.normalMapTiling=new pc.Vec2(T.scale[0],T.scale[1])),T.hasOwnProperty("offset")&&(o.normalMapOffset=new pc.Vec2(T.offset[0],T.offset[1]))}y.hasOwnProperty("scale")&&(o.bumpiness=y.scale)}if(s.hasOwnProperty("occlusionTexture")){var m=s.occlusionTexture;if(o.aoMap=t.textures[m.index],o.aoMapChannel="r",m.hasOwnProperty("texCoord")&&(o.aoMapUv=m.texCoord),m.hasOwnProperty("extensions")&&m.extensions.hasOwnProperty("KHR_texture_transform")){var E=m.extensions.KHR_texture_transform;E.hasOwnProperty("scale")&&(o.aoMapTiling=new pc.Vec2(E.scale[0],E.scale[1])),E.hasOwnProperty("offset")&&(o.aoMapOffset=new pc.Vec2(E.offset[0],E.offset[1]))}}if(s.hasOwnProperty("emissiveFactor")?(a=s.emissiveFactor,o.emissive.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)),o.emissiveTint=!0):(o.emissive.set(0,0,0),o.emissiveTint=!1),s.hasOwnProperty("emissiveTexture")){var P=s.emissiveTexture;if(o.emissiveMap=t.textures[P.index],P.hasOwnProperty("texCoord")&&(o.emissiveMapUv=P.texCoord),P.hasOwnProperty("extensions")&&P.extensions.hasOwnProperty("KHR_texture_transform")){var M=P.extensions.KHR_texture_transform;M.hasOwnProperty("scale")&&(o.emissiveMapTiling=new pc.Vec2(M.scale[0],M.scale[1])),M.hasOwnProperty("offset")&&(o.emissiveMapOffset=new pc.Vec2(M.offset[0],M.offset[1]))}}if(s.hasOwnProperty("alphaMode"))switch(s.alphaMode){case"MASK":o.blendType=pc.BLEND_NONE,s.hasOwnProperty("alphaCutoff")?o.alphaTest=s.alphaCutoff:o.alphaTest=.5;break;case"BLEND":o.blendType=pc.BLEND_NORMAL;break;default:case"OPAQUE":o.blendType=pc.BLEND_NONE}else o.blendType=pc.BLEND_NONE;return s.hasOwnProperty("doubleSided")?(o.twoSidedLighting=s.doubleSided,o.cull=s.doubleSided?pc.CULLFACE_NONE:pc.CULLFACE_BACK):(o.twoSidedLighting=!1,o.cull=pc.CULLFACE_BACK),s.hasOwnProperty("extras")&&t.processMaterialExtras&&t.processMaterialExtras(o,s.extras),o.update(),o}function translateMesh(e,r){var s=r.gltf,t=[];return e.primitives.forEach((function(e){var a,n,o=e.attributes,i=null,c=null,p=null,f=null,l=null,u=null,d=null,h=null,w=null;if(e.hasOwnProperty("extensions")){var O=e.extensions;if(O.hasOwnProperty("KHR_draco_mesh_compression")){var y=O.KHR_draco_mesh_compression,T=s.bufferViews[y.bufferView],m=r.buffers[T.buffer],E=T.hasOwnProperty("byteOffset")?T.byteOffset:0,P=new Int8Array(m,E,T.byteLength),M=r.decoderModule,A=new M.DecoderBuffer;A.Init(P,P.length);var g,I,v=new M.Decoder,_=v.GetEncodedGeometryType(A);switch(_){case M.INVALID_GEOMETRY_TYPE:console.error("Invalid geometry type");break;case M.POINT_CLOUD:g=new M.PointCloud,I=v.DecodeBufferToPointCloud(A,g);break;case M.TRIANGULAR_MESH:g=new M.Mesh,I=v.DecodeBufferToMesh(A,g)}if(!I.ok()||0==g.ptr){var x=I.error_msg();console.error(x)}var b=g.num_points(),R=g.num_faces();if(y.hasOwnProperty("attributes")){var extractAttribute=function(e){var r=v.GetAttributeByUniqueId(g,e),s=new M.DracoFloat32Array;v.GetAttributeFloatForAllPoints(g,r,s);var t=b*r.num_components(),n=new Float32Array(t);for(a=0;a<t;a++)n[a]=s.GetValue(a);return M.destroy(s),n},C=y.attributes;C.hasOwnProperty("POSITION")&&(i=extractAttribute(C.POSITION)),C.hasOwnProperty("NORMAL")&&(c=extractAttribute(C.NORMAL)),C.hasOwnProperty("TANGENT")&&(p=extractAttribute(C.TANGENT)),C.hasOwnProperty("TEXCOORD_0")&&(f=extractAttribute(C.TEXCOORD_0)),C.hasOwnProperty("TEXCOORD_1")&&(l=extractAttribute(C.TEXCOORD_1)),C.hasOwnProperty("COLOR_0")&&(u=extractAttribute(C.COLOR_0)),C.hasOwnProperty("JOINTS_0")&&(d=extractAttribute(C.JOINTS_0)),C.hasOwnProperty("WEIGHTS_0")&&(h=extractAttribute(C.WEIGHTS_0))}if(_==M.TRIANGULAR_MESH){var N=new M.DracoInt32Array;for(w=b>65535?new Uint32Array(3*R):new Uint16Array(3*R),a=0;a<R;++a)v.GetFaceFromMesh(g,a,N),w[3*a]=N.GetValue(0),w[3*a+1]=N.GetValue(1),w[3*a+2]=N.GetValue(2);M.destroy(N)}M.destroy(g),M.destroy(v),M.destroy(A)}}o.hasOwnProperty("POSITION")&&null===i&&(n=s.accessors[e.attributes.POSITION],i=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("NORMAL")&&null===c&&(n=s.accessors[e.attributes.NORMAL],c=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("TANGENT")&&null===p&&(n=s.accessors[e.attributes.TANGENT],p=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("TEXCOORD_0")&&null===f&&(n=s.accessors[e.attributes.TEXCOORD_0],f=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("TEXCOORD_1")&&null===l&&(n=s.accessors[e.attributes.TEXCOORD_1],l=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("COLOR_0")&&null===u&&(n=s.accessors[e.attributes.COLOR_0],u=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("JOINTS_0")&&null===d&&(n=s.accessors[e.attributes.JOINTS_0],d=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("WEIGHTS_0")&&null===h&&(n=s.accessors[e.attributes.WEIGHTS_0],h=getAccessorData(s,n,r.buffers)),e.hasOwnProperty("indices")&&null===w&&(n=s.accessors[e.indices],w=getAccessorData(s,n,r.buffers));var S=i.length/3;null!==i&&null===c&&(c=pc.calculateNormals(i,null===w?function(){var e=new Uint16Array(S);for(a=0;a<S;a++)e[a]=a;return e}():w));var L=[];i&&L.push({semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32}),c&&L.push({semantic:pc.SEMANTIC_NORMAL,components:3,type:pc.TYPE_FLOAT32}),p&&L.push({semantic:pc.SEMANTIC_TANGENT,components:4,type:pc.TYPE_FLOAT32}),f&&L.push({semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32}),l&&L.push({semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32}),u&&L.push({semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_UINT8,normalize:!0}),d&&L.push({semantic:pc.SEMANTIC_BLENDINDICES,components:4,type:pc.TYPE_UINT8}),h&&L.push({semantic:pc.SEMANTIC_BLENDWEIGHT,components:4,type:pc.TYPE_FLOAT32});var U,D,V,F,G,k=new pc.VertexFormat(r.device,L),B=new pc.VertexBuffer(r.device,k,S,pc.BUFFER_STATIC),H=B.lock(),K=new Float32Array(H),X=new Uint8Array(H),getAttribute=function(e){var r=k.elements;for(a=0;a<r.length;a++)if(r[a].name===e)return r[a];return null};if(null!==i)for(F=(V=getAttribute(pc.SEMANTIC_POSITION)).offset/4,G=V.stride/4,a=0;a<S;a++)D=3*a,K[U=F+a*G]=i[D],K[U+1]=i[D+1],K[U+2]=i[D+2];if(null!==c)for(F=(V=getAttribute(pc.SEMANTIC_NORMAL)).offset/4,G=V.stride/4,a=0;a<S;a++)D=3*a,K[U=F+a*G]=c[D],K[U+1]=c[D+1],K[U+2]=c[D+2];if(null!==p)for(F=(V=getAttribute(pc.SEMANTIC_TANGENT)).offset/4,G=V.stride/4,a=0;a<S;a++)D=4*a,K[U=F+a*G]=p[D],K[U+1]=p[D+1],K[U+2]=p[D+2],K[U+3]=p[D+3];if(null!==f)for(F=(V=getAttribute(pc.SEMANTIC_TEXCOORD0)).offset/4,G=V.stride/4,a=0;a<S;a++)D=2*a,K[U=F+a*G]=f[D],K[U+1]=f[D+1];if(null!==l)for(F=(V=getAttribute(pc.SEMANTIC_TEXCOORD1)).offset/4,G=V.stride/4,a=0;a<S;a++)D=2*a,K[U=F+a*G]=l[D],K[U+1]=l[D+1];if(null!==u)for(F=(V=getAttribute(pc.SEMANTIC_COLOR)).offset,G=V.stride,n=s.accessors[e.attributes.COLOR_0],a=0;a<S;a++){U=F+a*G;var Y=u[D="VEC4"===n.type?4*a:3*a],W=u[D+1],$=u[D+2],Q=u[D+3];X[U]=Math.round(255*pc.math.clamp(Y,0,1)),X[U+1]=Math.round(255*pc.math.clamp(W,0,1)),X[U+2]=Math.round(255*pc.math.clamp($,0,1)),X[U+3]="VEC4"===n.type?Math.round(255*pc.math.clamp(Q,0,1)):255}if(null!==d)for(F=(V=getAttribute(pc.SEMANTIC_BLENDINDICES)).offset,G=V.stride,a=0;a<S;a++)D=4*a,X[U=F+a*G]=d[D],X[U+1]=d[D+1],X[U+2]=d[D+2],X[U+3]=d[D+3];if(null!==h)for(F=(V=getAttribute(pc.SEMANTIC_BLENDWEIGHT)).offset/4,G=V.stride/4,a=0;a<S;a++)D=4*a,K[U=F+a*G]=h[D],K[U+1]=h[D+1],K[U+2]=h[D+2],K[U+3]=h[D+3];B.unlock();var j=new pc.Mesh;if(j.vertexBuffer=B,j.primitive[0].type=function getPrimitiveType(e){var r=pc.PRIMITIVE_TRIANGLES;if(e.hasOwnProperty("mode"))switch(e.mode){case 0:r=pc.PRIMITIVE_POINTS;break;case 1:r=pc.PRIMITIVE_LINES;break;case 2:r=pc.PRIMITIVE_LINELOOP;break;case 3:r=pc.PRIMITIVE_LINESTRIP;break;case 4:r=pc.PRIMITIVE_TRIANGLES;break;case 5:r=pc.PRIMITIVE_TRISTRIP;break;case 6:r=pc.PRIMITIVE_TRIFAN}return r}(e),j.primitive[0].base=0,j.primitive[0].indexed=null!==w,null!==w){var J;J=w instanceof Uint8Array?pc.INDEXFORMAT_UINT8:w instanceof Uint16Array?pc.INDEXFORMAT_UINT16:pc.INDEXFORMAT_UINT32;var q=w.length,z=new pc.IndexBuffer(r.device,J,q,pc.BUFFER_STATIC,w);j.indexBuffer[0]=z,j.primitive[0].count=w.length}else j.primitive[0].count=S;j.materialIndex=e.material;var Z=(n=s.accessors[e.attributes.POSITION]).min,ee=n.max,re=new pc.BoundingBox(new pc.Vec3((ee[0]+Z[0])/2,(ee[1]+Z[1])/2,(ee[2]+Z[2])/2),new pc.Vec3((ee[0]-Z[0])/2,(ee[1]-Z[1])/2,(ee[2]-Z[2])/2));if(j.aabb=re,e.hasOwnProperty("targets")){var se=[];e.targets.forEach((function(e){var t={};e.hasOwnProperty("POSITION")&&(n=s.accessors[e.POSITION],t.deltaPositions=getAccessorData(s,n,r.buffers)),e.hasOwnProperty("NORMAL")&&(n=s.accessors[e.NORMAL],t.deltaNormals=getAccessorData(s,n,r.buffers)),e.hasOwnProperty("TANGENT")&&(n=s.accessors[e.TANGENT],t.deltaTangents=getAccessorData(s,n,r.buffers)),se.push(new pc.MorphTarget(t))})),j.morph=new pc.Morph(se)}t.push(j)})),t}var s=new pc.Mat4,t=new pc.Vec3;function translateNode(e,r){var a=new pc.GraphNode;if(e.hasOwnProperty("name")?a.name=e.name:a.name="Node "+r.nodeCounter,e.hasOwnProperty("matrix")&&(s.data.set(e.matrix),s.getTranslation(t),a.setLocalPosition(t),s.getEulerAngles(t),a.setLocalEulerAngles(t),s.getScale(t),a.setLocalScale(t)),e.hasOwnProperty("rotation")){var n=e.rotation;a.setLocalRotation(n[0],n[1],n[2],n[3])}if(e.hasOwnProperty("translation")){var o=e.translation;a.setLocalPosition(o[0],o[1],o[2])}if(e.hasOwnProperty("scale")){var i=e.scale;a.setLocalScale(i[0],i[1],i[2])}return r.nodeCounter++,a}function translateSkin(e,r){var s,t,a,n=r.gltf,o=e.joints,i=o.length,c=[];if(e.hasOwnProperty("inverseBindMatrices")){var p=e.inverseBindMatrices,f=getAccessorData(n,n.accessors[p],r.buffers),l=[];for(s=0;s<i;s++){for(t=0;t<16;t++)l[t]=f[16*s+t];(a=new pc.Mat4).set(l),c.push(a)}}else for(s=0;s<i;s++)a=new pc.Mat4,c.push(a);var u=[];for(s=0;s<i;s++)u[s]=r.nodes[o[s]].name;var d=e.skeleton,h=new pc.Skin(r.device,c,u);for(h.skeleton=r.nodes[d],h.bones=[],s=0;s<o.length;s++)h.bones[s]=r.nodes[o[s]];return h}function translateTexture(e,r){var s=new pc.Texture(r.device,{flipY:!1});if(e.hasOwnProperty("name")&&(s.name=e.name),e.hasOwnProperty("sampler")){var t=r.gltf.samplers[e.sampler];t.hasOwnProperty("minFilter")&&(s.minFilter=getFilter(t.minFilter)),t.hasOwnProperty("magFilter")&&(s.magFilter=getFilter(t.magFilter)),t.hasOwnProperty("wrapS")&&(s.addressU=getWrap(t.wrapS)),t.hasOwnProperty("wrapT")&&(s.addressV=getWrap(t.wrapT))}return s}function parse(e,r,s,t){if(t){if(!s.gltf.hasOwnProperty(e))return void t();if(0===s.gltf[e].length)return void t()}s.gltf.hasOwnProperty(e)&&(s[e]=s.gltf[e].map((function(e){return r(e,s,t)})))}function createModel(e){var r=e.gltf,s=[],t=[],a=[];r.nodes.forEach((function(r,n){r.hasOwnProperty("mesh")&&e.meshes[r.mesh].forEach((function(o){var i;i=void 0===o.materialIndex?e.defaultMaterial:e.materials[o.materialIndex];var c=new pc.MeshInstance(e.nodes[n],o,i);if(s.push(c),o.morph){var p=new pc.MorphInstance(o.morph);c.morphInstance=p,p.updateBounds(c.mesh),o.weights&&o.weights.forEach((function(e,r){p.setWeight(r,e)})),a.push(p)}if(r.hasOwnProperty("skin")){var f=e.skins[r.skin];o.skin=f;var l=new pc.SkinInstance(f);l.bones=f.bones,c.skinInstance=l,t.push(l)}}))}));var n=new pc.Model,o=function getRoots(e){var r=e.gltf,s=[];if(r.hasOwnProperty("scenes")){var t=0;r.hasOwnProperty("scene")&&(t=r.scene);for(var a=r.scenes[t].nodes,n=0;n<a.length;n++)s.push(e.nodes[a[n]])}else s.push(e.nodes[0]);return s}(e);return 1===o.length?n.graph=o[0]:(n.graph=new pc.GraphNode,o.forEach((function(e){n.graph.addChild(e)}))),n.meshInstances=s,n.morphInstances=a,n.skinInstances=t,n}function loadGltf(e,r,s,t){var a=t&&t.hasOwnProperty("buffers")?t.buffers:void 0,n=t&&t.hasOwnProperty("basePath")?t.basePath:void 0,o=t&&t.hasOwnProperty("processUri")?t.processUri:void 0,i=t&&t.hasOwnProperty("processAnimationExtras")?t.processAnimationExtras:void 0,c=t&&t.hasOwnProperty("processMaterialExtras")?t.processMaterialExtras:void 0,p=t&&t.hasOwnProperty("processGlobalExtras")?t.processGlobalExtras:void 0,f={basePath:n,buffers:a,device:r,defaultMaterial:translateMaterial({}),gltf:e,imagesLoaded:0,nodeCounter:0,processUri:o,processAnimationExtras:i,processMaterialExtras:c};e.hasOwnProperty("extensionsUsed")&&-1!==e.extensionsUsed.indexOf("KHR_draco_mesh_compression")&&(f.decoderModule=t.decoderModule),function loadBuffers(e,r){if(e.buffers)r();else{var s=e.gltf;if(e.buffers=[],s.hasOwnProperty("buffers")){var t=0;s.buffers.forEach((function(a,n){if(a.hasOwnProperty("uri"))if(isDataURI(a.uri)){var o=atob(a.uri.split(",")[1]);e.buffers[n]=new ArrayBuffer(o.length);for(var i=new Uint8Array(e.buffers[n]),c=0;c<o.length;c++)i[c]=o.charCodeAt(c);s.buffers.length===++t&&r()}else if(e.processUri)e.processUri(a.uri,(function(a){e.buffers[n]=a,s.buffers.length===++t&&r()}));else{var p=new XMLHttpRequest;p.open("GET",e.basePath+a.uri,!0),p.responseType="arraybuffer",p.onload=function(a){e.buffers[n]=this.response,s.buffers.length===++t&&r()},p.send()}}))}}}(f,(function(){parse("textures",translateTexture,f),parse("images",translateImage,f,(function(){parse("materials",translateMaterial,f),parse("meshes",translateMesh,f),parse("nodes",translateNode,f),parse("skins",translateSkin,f),parse("animations",translateAnimation,f),e.hasOwnProperty("extras")&&p&&p(e.extras),function buildHierarchy(e){e.gltf.nodes.forEach((function(r,s){r.hasOwnProperty("children")&&r.children.forEach((function(r){var t=e.nodes[r];t.parent&&t.parent.removeChild(t),e.nodes[s].addChild(t)}))}))}(f),s(null,{model:createModel(f),textures:f.textures,animations:f.animations}),e.hasOwnProperty("extensionsUsed")&&-1!==e.extensionsUsed.indexOf("KHR_draco_mesh_compression")&&(f.decoderModule=null)}))}))}return{loadGltf:loadGltf,loadGlb:function loadGlb(e,r,s,t){var a=new DataView(e),n=a.getUint32(0,!0);if(1179937895===n){var o=a.getUint32(4,!0);if(2===o){var i=a.getUint32(8,!0),c=a.getUint32(12,!0),p=a.getUint32(16,!0);if(1313821514===p){for(var f=new Uint8Array(e,20,c),l=JSON.parse(function decodeBinaryUtf8(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var r="",s=0,t=e.length;s<t;s++)r+=String.fromCharCode(e[s]);return decodeURIComponent(escape(r))}(f)),u=[],d=20+c;d<i;){if(c=a.getUint32(d,!0),5130562!==(p=a.getUint32(d+4,!0)))return void s("Invalid chunk type found in glb file. Expected 0x004E4942, found 0x"+p.toString(16));var h=e.slice(d+8,d+8+c);u.push(h),d+=c+8}(t=t||{}).buffers=u,loadGltf(l,r,s,t)}else s("Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x"+p.toString(16))}else s("Invalid version number found in glb header. Expected 2, found "+o)}else s("Invalid magic number found in glb header. Expected 0x46546C67, found 0x"+n.toString(16))}}}());var DeleteButton=pc.createScript("deleteButton");DeleteButton.attributes.add("balloonEntity",{type:"entity"}),DeleteButton.attributes.add("balloonHolderEntity",{type:"entity"}),DeleteButton.attributes.add("balloonStrings",{type:"entity",array:!0}),DeleteButton.attributes.add("balloonManager",{type:"entity"}),DeleteButton.prototype.initialize=function(){this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this),this.entity.element.on("touchstart",this.onPress,this),this.entity.element.on("touchend",this.onRelease,this)},DeleteButton.prototype.onEnter=function(t){this.hovered=!0},DeleteButton.prototype.update=function(t){},DeleteButton.prototype.onPress=function(t){this.balloonManager.script.balloonTracker.deleteBalloon()};var BalloonTracker=pc.createScript("balloonTracker");BalloonTracker.attributes.add("BalloonParent",{type:"entity"}),BalloonTracker.attributes.add("BalloonPopParticles",{type:"asset"}),BalloonTracker.attributes.add("defaultURL",{type:"string"}),BalloonTracker.attributes.add("testFileNames",{type:"string",array:!0});var defaultStringLength=1,defaultStringSegments=5,currentIndex=0;BalloonTracker.prototype.initialize=function(){this.app.systems.rigidbody.fixedTimeStep=1/90,this.app.systems.rigidbody.maxSubSteps=13,this.app.on("BalloonBuilder:balloonTracker:addBalloon",(function(e){this.addBalloon()}),this),this.app.on("BalloonBuilder:balloonTracker:deleteBalloon",(function(e){this.deleteBalloon()}),this),this.app.on("BalloonBuilder:balloonTracker:increaseString",(function(e){this.increaseString()}),this),this.app.on("BalloonBuilder:balloonTracker:decreaseString",(function(e){this.decreaseString()}),this),this.app.on("BalloonBuilder:balloonTracker:replaceBalloon",(function(e){this.replaceBalloon()}),this),this.exposeFunctions()},BalloonTracker.prototype.replaceBalloon=function(e,t){var n=this.app,o=this.entity.script.balloonSelection.selectedItem;if(void 0!==e)for(var l=0;l<this.BalloonParent.children.length;l++)this.BalloonParent.children[l].script.balloonInfo.itemNumber==e&&(o=this.BalloonParent.children[l].script.balloonInfo.BalloonObject.children[0]);if(void 0!==o){var i="863280.gltf";""!==t&&void 0!==t?i=t+".gltf":(i=this.testFileNames[currentIndex]+".gltf",++currentIndex>=this.testFileNames.length&&(currentIndex=0)),n.assets.loadFromUrl(this.defaultURL+i,"json",(function(e,t){var l=JSON.parse(t.resource);loadGltf(l,n.graphicsDevice,(function(e,t){var l=new pc.Asset(i,"model",{url:""});l.resource=t.model,l.loaded=!0,n.assets.add(l),o.setLocalPosition(0,0,0),o.setLocalEulerAngles(0,0,0);var a=o.getEulerAngles();o.setEulerAngles(0,0,0);var r=o.parent.script.pointToPointConstraint;r.enabled=!1;var s=o.model.layers.slice();o.removeComponent("model"),o.addComponent("model",{asset:l}),o.model.layers=s,o.collision.type="mesh",o.collision.model.meshInstances[0]=o.model.meshInstances[0];o.model.meshInstances;var c=new pc.BoundingBox;c.copy(o.model.meshInstances[0].aabb),o.parent.collision.halfExtents=c.halfExtents.clone(),o.setEulerAngles(a),r.pivotA=new pc.Vec3(0,-c.halfExtents.y,0),r.enabled=!0}),{basePath:this.defaultURL})}))}},BalloonTracker.prototype.deleteBalloon=function(e){var t=this.entity.script.balloonSelection.selectedItem;if(void 0!==e)for(var n=0;n<this.BalloonParent.children.length;n++)this.BalloonParent.children[n].script.balloonInfo.itemNumber==e&&(t=this.BalloonParent.children[n].script.balloonInfo.BalloonObject.children[0]);if(void 0!==t){var o=this.BalloonPopParticles.resource.instantiate();this.app.root.addChild(o),o.setPosition(t.parent.getPosition());var l=t.model.meshInstances[0].material.diffuse;o.particlesystem.colorGraph.value(0,l),o.particlesystem.colorGraph.curves[0].keys[0][1]=l.r,o.particlesystem.colorGraph.curves[1].keys[0][1]=l.g,o.particlesystem.colorGraph.curves[2].keys[0][1]=l.b,o.particlesystem.rebuild(),t.parent.parent.script.balloonInfo.destroyBalloon(),this.entity.script.balloonSelection.selectedItem=void 0,this.entity.script.balloonSelection.highlight.saturation=0}},BalloonTracker.prototype.setStringLength=function(e,t){var n=this.entity.script.balloonSelection.selectedItem;if(void 0!==e)for(var o=0;o<this.BalloonParent.children.length;o++)this.BalloonParent.children[o].script.balloonInfo.itemNumber==e&&(n=this.BalloonParent.children[o].script.balloonInfo.BalloonObject.children[0]);void 0!==n&&(n.parent.parent.script.balloonInfo.stringLength=t)},BalloonTracker.prototype.increaseString=function(e){var t=this.entity.script.balloonSelection.selectedItem;if(void 0!==e)for(var n=0;n<this.BalloonParent.children.length;n++)this.BalloonParent.children[n].script.balloonInfo.itemNumber==e&&(t=this.BalloonParent.children[n].script.balloonInfo.BalloonObject.children[0]);if(void 0!==t){var o=t.parent.parent.script.balloonInfo.stringLength;o+=.0254*6,t.parent.parent.script.balloonInfo.stringLength=o}},BalloonTracker.prototype.decreaseString=function(e){var t=this.entity.script.balloonSelection.selectedItem;if(void 0!==e)for(var n=0;n<this.BalloonParent.children.length;n++)this.BalloonParent.children[n].script.balloonInfo.itemNumber==e&&(t=this.BalloonParent.children[n].script.balloonInfo.BalloonObject.children[0]);if(void 0!==t){var o=t.parent.parent.script.balloonInfo.stringLength;o-=.0254*6,t.parent.parent.script.balloonInfo.stringLength=o}},BalloonTracker.prototype.addBalloon=function(e,t){var n="Balloon"+(this.BalloonParent.children.length+1).toString(),o=new pc.Entity(n);o.addComponent("script");var l=o.script.create("balloonInfo");o.script.create("lineRenderer");if(this.BalloonParent.addChild(o),o.children.length>0){var i=o.children[0];o.removeChild(i)}for(var a=defaultStringLength/defaultStringSegments,r=[],s=0;s<defaultStringSegments;s++){var c=new pc.Entity("Joint"+s.toString()),d=new pc.Vec3(0,a/2*(s+1),0);c.setLocalPosition(d),c.addComponent("collision"),c.addComponent("rigidbody");var p=c.collision,h=c.rigidbody;p.type="cylinder",p.radius=.01,p.height=.9*a,p.axis=1,h.type="static",h.mass=.01,h.linearDamping=.2,h.angularDamping=.4,c.addComponent("script"),c.script.create("pointToPointConstraint",{enabled:!1});var f=c.script.pointToPointConstraint;f.pivotA=new pc.Vec3(0,-a/2,0),f.pivotB=new pc.Vec3(0,a/2,0),f.enableCollision=!1,o.addChild(c),l.Joints.push(c),r.push(c)}var u=this.app,g="47094.gltf";""!==t&&void 0!==t?g=t+".gltf":(g=this.testFileNames[currentIndex]+".gltf",++currentIndex>=this.testFileNames.length&&(currentIndex=0)),u.assets.loadFromUrl(this.defaultURL+g,"json",(function(t,n){var i=JSON.parse(n.resource);loadGltf(i,u.graphicsDevice,(function(t,n){var i=new pc.Asset(g,"model",{url:""});i.resource=n.model,i.loaded=!0,u.assets.add(i);var s=new pc.Entity("Balloon");s.addComponent("script");var c=new pc.Entity("BalloonMesh");c.tags.add("balloonMesh"),c.addComponent("model",{asset:i}),l.BalloonObject=s,c.addComponent("collision"),c.collision.type="mesh",c.collision.model=c.model.model,c.collision.enabled=!1;var d=c.model.meshInstances,p=new pc.BoundingBox;p.copy(d[0].aabb),s.addComponent("collision");var h=s.collision;h.type="box",h.axis=1,h.halfExtents=p.halfExtents.clone();var f=new pc.Vec3(0,defaultStringSegments*a+p.halfExtents.y,0);s.setLocalPosition(f),s.addComponent("rigidbody");var m=s.rigidbody;m.type="static",m.mass=.01,m.angularDamping=.4,m.linearDamping=.4,m.friction=.85,m.restitution=.81,s.script.create("pointToPointConstraint",{enabled:!1});var B=s.script.pointToPointConstraint;B.pivotA=new pc.Vec3(0,-p.halfExtents.y,0),B.pivotB=new pc.Vec3(0,a/2,0),B.enableCollision=!0,s.addChild(c),o.addChild(s),r.push(s);for(var b=0;b<r.length;b++)r[b].script.pointToPointConstraint.enabled=!1,b>0&&(r[b].script.pointToPointConstraint.entityB=r[b-1]);l.Joints=r,void 0!==e&&(l.itemNumber=e)}),{basePath:this.defaultURL})}))},BalloonTracker.prototype.update=function(e){},BalloonTracker.prototype.exposeFunctions=function(){var e=this.entity.script.balloonTracker;window.addBalloon=function(t,n){e.addBalloon(t,n)},window.deleteBalloon=function(t){e.deleteBalloon(t)},window.increaseString=function(t){e.increaseString(t)},window.decreaseString=function(t){e.decreaseString(t)},window.setStringLength=function(t,n){e.setStringLength(t,n)},window.replaceBalloon=function(t,n){e.replaceBalloon(t,n)}};var DestroyAfter=pc.createScript("destroyAfter");DestroyAfter.attributes.add("Timer",{type:"number"}),DestroyAfter.prototype.initialize=function(){this.timeCount=0},DestroyAfter.prototype.update=function(t){this.timeCount+=t,this.timeCount>=this.Timer&&this.entity.destroy()};var TestUi=pc.createScript("testUi");TestUi.attributes.add("Button_DeleteBalloon",{type:"entity"}),TestUi.attributes.add("Button_ReplaceBalloon",{type:"entity"}),TestUi.attributes.add("Button_IncreaseString",{type:"entity"}),TestUi.attributes.add("Button_DecreaseString",{type:"entity"}),TestUi.prototype.initialize=function(){this.Button_DeleteBalloon.element.on("click",(function(t){t.stopPropagation()}),this),this.Button_DeleteBalloon.element.on("mousedown",(function(t){t.stopPropagation()}),this),this.Button_DeleteBalloon.element.on("mouseup",(function(t){t.stopPropagation()}),this),this.Button_DeleteBalloon.element.on("click",this.onClick,this),this.Button_IncreaseString.element.on("click",(function(t){t.stopPropagation()}),this),this.Button_IncreaseString.element.on("mousedown",(function(t){t.stopPropagation()}),this),this.Button_IncreaseString.element.on("mouseup",(function(t){t.stopPropagation()}),this),this.Button_IncreaseString.element.on("click",this.onClick,this),this.Button_DecreaseString.element.on("click",(function(t){t.stopPropagation()}),this),this.Button_DecreaseString.element.on("mousedown",(function(t){t.stopPropagation()}),this),this.Button_DecreaseString.element.on("mouseup",(function(t){t.stopPropagation()}),this),this.Button_DecreaseString.element.on("click",this.onClick,this),this.Button_ReplaceBalloon.element.on("click",(function(t){t.stopPropagation()}),this),this.Button_ReplaceBalloon.element.on("mousedown",(function(t){t.stopPropagation()}),this),this.Button_ReplaceBalloon.element.on("mouseup",(function(t){t.stopPropagation()}),this),this.Button_ReplaceBalloon.element.on("click",this.onClick,this)},TestUi.prototype.onClick=function(t){t.element.entity==this.Button_AddBalloon&&this.app.fire("BalloonBuilder:balloonTracker:addBalloon"),t.element.entity==this.Button_DeleteBalloon&&this.app.fire("BalloonBuilder:balloonTracker:deleteBalloon"),t.element.entity==this.Button_IncreaseString&&this.app.fire("BalloonBuilder:balloonTracker:increaseString"),t.element.entity==this.Button_DecreaseString&&this.app.fire("BalloonBuilder:balloonTracker:decreaseString"),t.element.entity==this.Button_ReplaceBalloon&&this.app.fire("BalloonBuilder:balloonTracker:replaceBalloon")},TestUi.prototype.update=function(t){};Object.assign(pc,function(){var OutlineEffect=function(e,t){pc.PostEffect.call(this,e),this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","#define THICKNESS "+t.toFixed(0),"uniform float uWidth;","uniform float uHeight;","uniform vec4 uOutlineCol;","uniform sampler2D uColorBuffer;","uniform sampler2D uOutlineTex;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    float sample0 = texture2D(uOutlineTex, vUv0).a;","    float outline = 0.0;","    if (sample0==0.0)","    {","        for (int x=-THICKNESS;x<=THICKNESS;x++)","        {","            for (int y=-THICKNESS;y<=THICKNESS;y++)","            {    ","                float sample=texture2D(uOutlineTex, vUv0+vec2(float(x)/uWidth, float(y)/uHeight)).a;","                if (sample>0.0)","                {","                    outline=1.0;","                }","            }","        } ","    }","    gl_FragColor = mix(texel1, uOutlineCol, outline * uOutlineCol.a);","}"].join("\n")}),this.color=new pc.Color(1,1,1,1),this.texture=new pc.Texture(e),this.texture.name="pe-outline"};return(OutlineEffect.prototype=Object.create(pc.PostEffect.prototype)).constructor=OutlineEffect,Object.assign(OutlineEffect.prototype,{render:function(e,t,i){var o=this.device,r=o.scope;r.resolve("uWidth").setValue(e.width),r.resolve("uHeight").setValue(e.height),r.resolve("uOutlineCol").setValue(new Float32Array([this.color.r,this.color.g,this.color.b,this.color.a])),r.resolve("uColorBuffer").setValue(e.colorBuffer),r.resolve("uOutlineTex").setValue(this.texture),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{OutlineEffect:OutlineEffect}}());var Outline=pc.createScript("outline");Outline.attributes.add("color",{type:"rgb",default:[.5,.5,.5,1],title:"Color"}),Outline.attributes.add("texture",{type:"asset",assetType:"texture",title:"Texture"}),Outline.prototype.initialize=function(){this.effect=new pc.OutlineEffect(this.app.graphicsDevice),this.effect.color=this.color,this.effect.texture=this.texture.resource;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)})),this.on("attr:color",(function(e){this.effect.color=e}),this),this.on("attr:texture",(function(e){this.effect.texture=e?e.resource:null}),this)};Object.assign(pc,function(){var SaturationEffect=function(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform sampler2D uSaturationTex;","uniform float uSaturation;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    vec4 texel2 = texture2D(uSaturationTex, vUv0);","    float saturation = 0.0;","    float brightness = 0.2;","    float contrast = -0.2;","    if (texel2.a>0.0)","    {","       saturation=1.0;","       if(texel1.rgb != texel2.rgb) {","           saturation = 0.75;","       }","    }","    float average = (texel1.r + texel1.g + texel1.b) / 3.0;","    if (uSaturation > 0.0) {","       texel1.rgb += (average - texel1.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","    } else {","       texel1.rgb += (average - texel1.rgb) * (-uSaturation);","    }","    if (uSaturation < 0.0) {","       texel1.rgb += brightness;","        if(contrast > 0.0) {","           texel1.rgb = (texel1.rgb - 0.5) / (1.0 - contrast) + 0.5;","        } else {","           texel1.rgb = (texel1.rgb - 0.5) * (1.0 + contrast) + 0.5;","        }","    }","    gl_FragColor = mix(texel1, texel2, saturation);","}"].join("\n")}),this.texture=new pc.Texture(t),this.texture.name="pe-saturation",this.saturation=0};return(SaturationEffect.prototype=Object.create(pc.PostEffect.prototype)).constructor=SaturationEffect,Object.assign(SaturationEffect.prototype,{render:function(t,e,r){var a=this.device,i=a.scope;i.resolve("uColorBuffer").setValue(t.colorBuffer),i.resolve("uSaturation").setValue(this.saturation),i.resolve("uSaturationTex").setValue(this.texture),pc.drawFullscreenQuad(a,e,this.vertexBuffer,this.shader,r)}}),{SaturationEffect:SaturationEffect}}());var Saturation=pc.createScript("saturation");Saturation.attributes.add("texture",{type:"asset",assetType:"texture",title:"Texture"}),Saturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,precision:5,title:"Saturation"}),Saturation.prototype.initialize=function(){this.effect=new pc.SaturationEffect(this.app.graphicsDevice),this.effect.texture=this.texture.resource,this.effect.saturation=this.saturation;var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)})),this.on("attr:texture",(function(t){this.effect.texture=t?t.resource:null}),this)};var PrepareBalloon=pc.createScript("prepareBalloon");PrepareBalloon.attributes.add("BalloonObject",{type:"entity"}),PrepareBalloon.attributes.add("StringLength",{type:"number",precision:2,default:1}),PrepareBalloon.prototype.initialize=function(){var t=this.entity.getEulerAngles();this.entity.setEulerAngles(0,0,0),"Untitled"==this.entity.children[6].name&&this.entity.removeChild(this.entity.children[6]);for(var e=0;e<this.entity.children.length;e++)this.entity.children[e].script.pointToPointConstraint.enabled=!1;var n=this.BalloonObject.children[0],i=new pc.BoundingBox;i.copy(n.model.meshInstances[0].aabb),this.BalloonObject.collision.halfExtents=i.halfExtents.clone(),this.entity.setEulerAngles(t);var l=new pc.Vec3(0,this.StringLength+i.halfExtents.y,0);this.BalloonObject.setLocalPosition(l),this.BalloonObject.script.pointToPointConstraint.pivotA=new pc.Vec3(0,-i.halfExtents.y,0),this.BalloonObject.collision.enabled=!1,n.collision.enabled=!0,n.collision.enabled=!1,this.BalloonObject.collision.enabled=!0,this.entity.script.balloonInfo.BalloonObject=this.BalloonObject},PrepareBalloon.prototype.update=function(t){};